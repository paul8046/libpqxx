<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>util.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>util.h</h1><a href="util_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*-------------------------------------------------------------------------</span>
00002 <span class="comment"> *</span>
00003 <span class="comment"> *   FILE</span>
00004 <span class="comment"> *      pqxx/util.h</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> *   DESCRIPTION</span>
00007 <span class="comment"> *      Various utility definitions for libpqxx</span>
00008 <span class="comment"> *</span>
00009 <span class="comment"> * Copyright (c) 2001-2003, Jeroen T. Vermeulen &lt;jtv@xs4all.nl&gt;</span>
00010 <span class="comment"> *</span>
00011 <span class="comment"> *-------------------------------------------------------------------------</span>
00012 <span class="comment"> */</span>
00013 <span class="preprocessor">#ifndef PQXX_UTIL_H</span>
00014 <span class="preprocessor"></span><span class="preprocessor">#define PQXX_UTIL_H</span>
00015 <span class="preprocessor"></span>
00016 <span class="preprocessor">#include "<a class="code" href="compiler_8h.html">pqxx/compiler.h</a>"</span>
00017 
00018 <span class="preprocessor">#include &lt;cstdio&gt;</span>
00019 <span class="preprocessor">#include &lt;stdexcept&gt;</span>
00020 <span class="preprocessor">#include &lt;string&gt;</span>
00021 <span class="preprocessor">#include &lt;typeinfo&gt;</span>
00022 
00023 <span class="keyword">extern</span> <span class="stringliteral">"C"</span>
00024 {
00025 <span class="preprocessor">#include "libpq-fe.h"</span>
00026 }
00027 
00028 
00029 <span class="keyword">namespace </span>pqxx
00030 {
<a name="l00031"></a><a class="code" href="namespacepqxx.html#a5">00031</a> <span class="keyword">typedef</span> <span class="keywordtype">long</span> <a class="code" href="namespacepqxx.html#a5">Result_size_type</a>;
<a name="l00032"></a><a class="code" href="namespacepqxx.html#a6">00032</a> <span class="keyword">typedef</span> <span class="keywordtype">int</span> <a class="code" href="namespacepqxx.html#a6">Tuple_size_type</a>;
00033 
00036 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="namespacepqxx.html#a11">FmtString</a>(T);
00037 
00038 <span class="comment">// Not implemented to prevent accidents with irregular meaning of argument:</span>
00039 <span class="comment">// template&lt;&gt; inline const char *FmtString(const char *&amp;) { return "%s"; }</span>
00040 
<a name="l00041"></a><a class="code" href="namespacepqxx.html#a12">00041</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="namespacepqxx.html#a11">FmtString</a>(<span class="keywordtype">short</span>)         { <span class="keywordflow">return</span> <span class="stringliteral">"%hd"</span>; }
<a name="l00042"></a><a class="code" href="namespacepqxx.html#a13">00042</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="namespacepqxx.html#a11">FmtString</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>){ <span class="keywordflow">return</span> <span class="stringliteral">"%hu"</span>; }
<a name="l00043"></a><a class="code" href="namespacepqxx.html#a14">00043</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="namespacepqxx.html#a11">FmtString</a>(<span class="keywordtype">int</span>)           { <span class="keywordflow">return</span>  <span class="stringliteral">"%i"</span>; }
<a name="l00044"></a><a class="code" href="namespacepqxx.html#a15">00044</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="namespacepqxx.html#a11">FmtString</a>(<span class="keywordtype">long</span>)          { <span class="keywordflow">return</span> <span class="stringliteral">"%li"</span>; }
00045 <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="namespacepqxx.html#a11">FmtString</a>(<span class="keywordtype">unsigned</span>)      { <span class="keywordflow">return</span>  <span class="stringliteral">"%u"</span>; }
00046 <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="namespacepqxx.html#a11">FmtString</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) { <span class="keywordflow">return</span> <span class="stringliteral">"%lu"</span>; }
<a name="l00047"></a><a class="code" href="namespacepqxx.html#a16">00047</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="namespacepqxx.html#a11">FmtString</a>(<span class="keywordtype">float</span>)         { <span class="keywordflow">return</span>  <span class="stringliteral">"%f"</span>; }
<a name="l00048"></a><a class="code" href="namespacepqxx.html#a17">00048</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="namespacepqxx.html#a11">FmtString</a>(<span class="keywordtype">double</span>)        { <span class="keywordflow">return</span> <span class="stringliteral">"%lf"</span>; }
00049 <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="namespacepqxx.html#a11">FmtString</a>(<span class="keywordtype">long</span> <span class="keywordtype">double</span>)   { <span class="keywordflow">return</span> <span class="stringliteral">"%Lf"</span>; }
<a name="l00050"></a><a class="code" href="namespacepqxx.html#a18">00050</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="namespacepqxx.html#a11">FmtString</a>(<span class="keywordtype">char</span>)          { <span class="keywordflow">return</span>  <span class="stringliteral">"%c"</span>; }
00051 <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="namespacepqxx.html#a11">FmtString</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>) { <span class="keywordflow">return</span>  <span class="stringliteral">"%c"</span>; }
00052 
00053 
<a name="l00055"></a><a class="code" href="namespacepqxx.html#a19">00055</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> PGSTD::string <a class="code" href="namespacepqxx.html#a19">ToString</a>(<span class="keyword">const</span> T &amp;Obj)
00056 {
00057   <span class="comment">// TODO: Find a decent way to determine max string length at compile time!</span>
00058   <span class="keywordtype">char</span> Buf[500];
00059   sprintf(Buf, <a class="code" href="namespacepqxx.html#a11">FmtString</a>(Obj), Obj);
00060   <span class="keywordflow">return</span> PGSTD::string(Buf);
00061 }
00062 
<a name="l00063"></a><a class="code" href="namespacepqxx.html#a20">00063</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> PGSTD::string <a class="code" href="namespacepqxx.html#a19">ToString</a>(<span class="keyword">const</span> PGSTD::string &amp;Obj) {<span class="keywordflow">return</span> Obj;}
<a name="l00064"></a><a class="code" href="namespacepqxx.html#a21">00064</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> PGSTD::string <a class="code" href="namespacepqxx.html#a19">ToString</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> &amp;Obj) { <span class="keywordflow">return</span> Obj; }
<a name="l00065"></a><a class="code" href="namespacepqxx.html#a22">00065</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> PGSTD::string <a class="code" href="namespacepqxx.html#a19">ToString</a>(<span class="keywordtype">char</span> *<span class="keyword">const</span> &amp;Obj) { <span class="keywordflow">return</span> Obj; }
00066 
<a name="l00067"></a><a class="code" href="namespacepqxx.html#a23">00067</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> PGSTD::string <a class="code" href="namespacepqxx.html#a19">ToString</a>(<span class="keyword">const</span> <span class="keywordtype">bool</span> &amp;Obj) 
00068 { 
00069   <span class="keywordflow">return</span> <a class="code" href="namespacepqxx.html#a19">ToString</a>(<span class="keywordtype">unsigned</span>(Obj));
00070 }
00071 
<a name="l00072"></a><a class="code" href="namespacepqxx.html#a24">00072</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> PGSTD::string <a class="code" href="namespacepqxx.html#a19">ToString</a>(<span class="keyword">const</span> <span class="keywordtype">short</span> &amp;Obj)
00073 {
00074   <span class="keywordflow">return</span> <a class="code" href="namespacepqxx.html#a19">ToString</a>(<span class="keywordtype">int</span>(Obj));
00075 }
00076 
<a name="l00077"></a><a class="code" href="namespacepqxx.html#a25">00077</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> PGSTD::string <a class="code" href="namespacepqxx.html#a19">ToString</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> &amp;Obj)
00078 {
00079   <span class="keywordflow">return</span> <a class="code" href="namespacepqxx.html#a19">ToString</a>(<span class="keywordtype">unsigned</span>(Obj));
00080 }
00081 
00082 
<a name="l00083"></a><a class="code" href="namespacepqxx.html#a26">00083</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="namespacepqxx.html#a26">FromString</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> Str[], T &amp;Obj)
00084 {
00085   <span class="keywordflow">if</span> (!Str) <span class="keywordflow">throw</span> PGSTD::runtime_error(<span class="stringliteral">"Attempt to convert NULL string to "</span> +
00086                                      PGSTD::string(<span class="keyword">typeid</span>(T).name()));
00087 
00088   <span class="keywordflow">if</span> (sscanf(Str, <a class="code" href="namespacepqxx.html#a11">FmtString</a>(Obj), &amp;Obj) != 1)
00089     <span class="keywordflow">throw</span> PGSTD::runtime_error(<span class="stringliteral">"Cannot convert value '"</span> + 
00090                              PGSTD::string(Str) + 
00091                              <span class="stringliteral">"' to "</span> + <span class="keyword">typeid</span>(T).name());
00092 }
00093 
00094 
<a name="l00095"></a><a class="code" href="namespacepqxx.html#a27">00095</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="namespacepqxx.html#a26">FromString</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> Str[], PGSTD::string &amp;Obj)
00096 {
00097   <span class="keywordflow">if</span> (!Str) 
00098     <span class="keywordflow">throw</span> PGSTD::runtime_error(<span class="stringliteral">"Attempt to convert NULL C string to C++ "</span>
00099                                <span class="stringliteral">"string"</span>);
00100   Obj = Str;
00101 }
00102 
00103 
<a name="l00104"></a><a class="code" href="namespacepqxx.html#a28">00104</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="namespacepqxx.html#a26">FromString</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> Str[], <span class="keyword">const</span> <span class="keywordtype">char</span> *&amp;Obj)
00105 {
00106   <span class="keywordflow">if</span> (!Str)
00107     <span class="keywordflow">throw</span> PGSTD::runtime_error(<span class="stringliteral">"Attempt to read NULL string"</span>);
00108   Obj = Str;
00109 }
00110 
<a name="l00111"></a><a class="code" href="namespacepqxx.html#a29">00111</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="namespacepqxx.html#a26">FromString</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> Str[], <span class="keywordtype">bool</span> &amp;Obj)
00112 {
00113   <span class="keywordflow">if</span> (!Str)
00114     <span class="keywordflow">throw</span> PGSTD::runtime_error(<span class="stringliteral">"Attempt to read NULL string"</span>);
00115 
00116   <span class="keywordflow">switch</span> (Str[0])
00117   {
00118   <span class="keywordflow">case</span> 0:
00119   <span class="keywordflow">case</span> <span class="charliteral">'f'</span>:
00120     Obj = <span class="keyword">false</span>;
00121     <span class="keywordflow">break</span>;
00122   <span class="keywordflow">case</span> <span class="charliteral">'0'</span>:
00123     {
00124       <span class="keywordtype">int</span> I;
00125       <a class="code" href="namespacepqxx.html#a26">FromString</a>(Str, I);
00126       Obj = (I != 0);
00127     }
00128     <span class="keywordflow">break</span>;
00129   <span class="keywordflow">default</span>:
00130     Obj = <span class="keyword">true</span>;
00131   }
00132 }
00133 
00134 
00136 
00139 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> PGSTD::string <a class="code" href="namespacepqxx.html#a30">Quote</a>(<span class="keyword">const</span> T &amp;Obj, <span class="keywordtype">bool</span> EmptyIsNull);
00140 
<a name="l00142"></a><a class="code" href="namespacepqxx.html#a31">00142</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> PGSTD::string <a class="code" href="namespacepqxx.html#a30">Quote</a>(<span class="keyword">const</span> PGSTD::string &amp;Obj, 
00143                                       <span class="keywordtype">bool</span> EmptyIsNull)
00144 {
00145   <span class="keywordflow">if</span> (EmptyIsNull &amp;&amp; Obj.empty()) <span class="keywordflow">return</span> <span class="stringliteral">"null"</span>;
00146 
00147   PGSTD::string <a class="code" href="classpqxx_1_1Result.html">Result</a>;
00148   Result.reserve(Obj.size() + 2);
00149   Result += <span class="stringliteral">"'"</span>;
00150 
00151 <span class="preprocessor">#ifdef HAVE_PQESCAPESTRING</span>
00152 <span class="preprocessor"></span>
00153   <span class="keywordtype">char</span> *<span class="keyword">const</span> Buf = <span class="keyword">new</span> <span class="keywordtype">char</span>[2*Obj.size() + 1];
00154   <span class="keywordflow">try</span>
00155   {
00156     PQescapeString(Buf, Obj.c_str(), Obj.size());
00157     Result += Buf;
00158   }
00159   <span class="keywordflow">catch</span> (<span class="keyword">const</span> PGSTD::exception &amp;)
00160   {
00161     <span class="keyword">delete</span> [] Buf;
00162     <span class="keywordflow">throw</span>;
00163   }
00164   <span class="keyword">delete</span> [] Buf;
00165 
00166 <span class="preprocessor">#else</span>
00167 <span class="preprocessor"></span>
00168   <span class="keywordflow">for</span> (PGSTD::string::size_type i=0; i &lt; Obj.size(); ++i)
00169   {
00170     <span class="keywordflow">if</span> (isgraph(Obj[i]))
00171     {
00172       <span class="keywordflow">switch</span> (Obj[i])
00173       {
00174       <span class="keywordflow">case</span> <span class="charliteral">'\''</span>:
00175       <span class="keywordflow">case</span> <span class="charliteral">'\\'</span>:
00176         Result += <span class="charliteral">'\\'</span>;
00177       }
00178       Result += Obj[i];
00179     }
00180     <span class="keywordflow">else</span>
00181     {
00182         <span class="keywordtype">char</span> s[10];
00183         sprintf(s, 
00184                 <span class="stringliteral">"\\%03o"</span>, 
00185                 static_cast&lt;unsigned int&gt;(static_cast&lt;unsigned char&gt;(Obj[i])));
00186         Result.append(s, 4);
00187     }
00188   }
00189 
00190 <span class="preprocessor">#endif</span>
00191 <span class="preprocessor"></span>
00192   <span class="keywordflow">return</span> Result + <span class="charliteral">'\''</span>;
00193 }
00194 
00195 
<a name="l00198"></a><a class="code" href="namespacepqxx.html#a32">00198</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> PGSTD::string <a class="code" href="namespacepqxx.html#a30">Quote</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> &amp; Obj, 
00199                                       <span class="keywordtype">bool</span> EmptyIsNull)
00200 {
00201   <span class="keywordflow">if</span> (!Obj) <span class="keywordflow">return</span> <span class="stringliteral">"null"</span>;
00202   <span class="keywordflow">return</span> <a class="code" href="namespacepqxx.html#a30">Quote</a>(PGSTD::string(Obj), EmptyIsNull);
00203 }
00204 
00205 
00207 
<a name="l00212"></a><a class="code" href="namespacepqxx.html#a33">00212</a> <span class="keyword">template</span>&lt;<span class="keywordtype">int</span> LEN&gt; <span class="keyword">inline</span> PGSTD::string <a class="code" href="namespacepqxx.html#a30">Quote</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> (&amp;Obj)[LEN],
00213                                              <span class="keywordtype">bool</span> EmptyIsNull)          <span class="comment">//[t18]</span>
00214 {
00215   <span class="keywordflow">return</span> <a class="code" href="namespacepqxx.html#a30">Quote</a>(PGSTD::string(Obj), EmptyIsNull);
00216 }
00217 
00218 
<a name="l00222"></a><a class="code" href="namespacepqxx.html#a30">00222</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> PGSTD::string <a class="code" href="namespacepqxx.html#a30">Quote</a>(<span class="keyword">const</span> T &amp;Obj, <span class="keywordtype">bool</span> EmptyIsNull)
00223 {
00224   <span class="keywordflow">return</span> <a class="code" href="namespacepqxx.html#a30">Quote</a>(<a class="code" href="namespacepqxx.html#a19">ToString</a>(Obj), EmptyIsNull);
00225 }
00226 
00227 
00229 
<a name="l00231"></a><a class="code" href="namespacepqxx.html#a34">00231</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> PGSTD::string <a class="code" href="namespacepqxx.html#a30">Quote</a>(T Obj)
00232 {
00233   <span class="keywordflow">return</span> <a class="code" href="namespacepqxx.html#a30">Quote</a>(Obj, <span class="keyword">false</span>);
00234 }
00235 
00236 
00237 
00239 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; PGSTD::string <a class="code" href="namespacepqxx.html#a7">Classname</a>(<span class="keyword">const</span> T *);
00240 
00241 
00243 
<a name="l00248"></a><a class="code" href="classpqxx_1_1PQAlloc.html">00248</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">class </span><a class="code" href="classpqxx_1_1PQAlloc.html">PQAlloc</a>
00249 {
00250   T *m_Obj;
00251 <span class="keyword">public</span>:
<a name="l00252"></a><a class="code" href="classpqxx_1_1PQAlloc.html#a0">00252</a>   <a class="code" href="classpqxx_1_1PQAlloc.html#a0">PQAlloc</a>() : m_Obj(0) {}
00253 
<a name="l00255"></a><a class="code" href="classpqxx_1_1PQAlloc.html#a1">00255</a>   <span class="keyword">explicit</span> <a class="code" href="classpqxx_1_1PQAlloc.html#a0">PQAlloc</a>(T *obj) : m_Obj(obj) {}
00256 
<a name="l00257"></a><a class="code" href="classpqxx_1_1PQAlloc.html#a2">00257</a>   <a class="code" href="classpqxx_1_1PQAlloc.html#a2">~PQAlloc</a>() { <a class="code" href="classpqxx_1_1PQAlloc.html#a9">close</a>(); }
00258 
00260 
<a name="l00262"></a><a class="code" href="classpqxx_1_1PQAlloc.html#a3">00262</a>   <a class="code" href="classpqxx_1_1PQAlloc.html">PQAlloc</a> &amp;<a class="code" href="classpqxx_1_1PQAlloc.html#a3">operator=</a>(T *obj) <span class="keywordflow">throw</span> ()
00263   { 
00264     <span class="keywordflow">if</span> (obj != m_Obj)
00265     {
00266       <a class="code" href="classpqxx_1_1PQAlloc.html#a9">close</a>();
00267       m_Obj = obj;
00268     }
00269     <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00270   }
00271 
<a name="l00273"></a><a class="code" href="classpqxx_1_1PQAlloc.html#a4">00273</a>   <a class="code" href="classpqxx_1_1PQAlloc.html#a4">operator bool</a>() <span class="keyword">const</span> <span class="keywordflow">throw</span> () { <span class="keywordflow">return</span> m_Obj != 0; }
00274 
<a name="l00276"></a><a class="code" href="classpqxx_1_1PQAlloc.html#a5">00276</a>   <span class="keywordtype">bool</span> <a class="code" href="classpqxx_1_1PQAlloc.html#a5">operator!</a>() <span class="keyword">const</span> <span class="keywordflow">throw</span> () { <span class="keywordflow">return</span> !m_Obj; }
00277 
00279 
<a name="l00281"></a><a class="code" href="classpqxx_1_1PQAlloc.html#a6">00281</a>   T *<a class="code" href="classpqxx_1_1PQAlloc.html#a6">operator-&gt;</a>() <span class="keyword">const</span> <span class="keywordflow">throw</span> (PGSTD::logic_error)
00282   {
00283     <span class="keywordflow">if</span> (!m_Obj) <span class="keywordflow">throw</span> PGSTD::logic_error(<span class="stringliteral">"Null pointer dereferenced"</span>);
00284     <span class="keywordflow">return</span> m_Obj;
00285   }
00286 
00288 
<a name="l00290"></a><a class="code" href="classpqxx_1_1PQAlloc.html#a7">00290</a>   T &amp;<a class="code" href="classpqxx_1_1PQAlloc.html#a7">operator*</a>() <span class="keyword">const</span> <span class="keywordflow">throw</span> (PGSTD::logic_error) { <span class="keywordflow">return</span> *<a class="code" href="classpqxx_1_1PQAlloc.html#a6">operator-&gt;</a>(); }
00291 
00293 
<a name="l00295"></a><a class="code" href="classpqxx_1_1PQAlloc.html#a8">00295</a>   T *<a class="code" href="classpqxx_1_1PQAlloc.html#a8">c_ptr</a>() <span class="keyword">const</span> <span class="keywordflow">throw</span> () { <span class="keywordflow">return</span> m_Obj; }
00296 
<a name="l00298"></a><a class="code" href="classpqxx_1_1PQAlloc.html#a9">00298</a>   <span class="keywordtype">void</span> <a class="code" href="classpqxx_1_1PQAlloc.html#a9">close</a>() <span class="keywordflow">throw</span> () { <span class="keywordflow">if</span> (m_Obj) freemem(); m_Obj = 0; }
00299 
00300 <span class="keyword">private</span>:
00301   <span class="keywordtype">void</span> freemem() <span class="keywordflow">throw</span> ()
00302   {
00303 <span class="preprocessor">#ifdef HAVE_PQFREEMEM</span>
00304 <span class="preprocessor"></span>    PQfreemem(m_Obj);
00305 <span class="preprocessor">#else</span>
00306 <span class="preprocessor"></span>    free(m_Obj);
00307 <span class="preprocessor">#endif</span>
00308 <span class="preprocessor"></span>  }
00309 
00310   <a class="code" href="classpqxx_1_1PQAlloc.html#a0">PQAlloc</a>(<span class="keyword">const</span> PQAlloc &amp;);             <span class="comment">// Not allowed</span>
00311   <a class="code" href="classpqxx_1_1PQAlloc.html#a0">PQAlloc</a> &amp;<a class="code" href="classpqxx_1_1PQAlloc.html#a3">operator=</a>(<span class="keyword">const</span> PQAlloc &amp;);  <span class="comment">// Not allowed</span>
00312 };
00313 
00314 
00315 
00321 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> GUEST&gt;
<a name="l00322"></a><a class="code" href="classpqxx_1_1Unique.html">00322</a> <span class="keyword">class </span><a class="code" href="classpqxx_1_1Unique.html">Unique</a>
00323 {
00324 <span class="keyword">public</span>:
<a name="l00325"></a><a class="code" href="classpqxx_1_1Unique.html#a0">00325</a>   <a class="code" href="classpqxx_1_1Unique.html#a0">Unique</a>() : m_Guest(0) {}
00326 
<a name="l00327"></a><a class="code" href="classpqxx_1_1Unique.html#a1">00327</a>   GUEST *<a class="code" href="classpqxx_1_1Unique.html#a1">get</a>() <span class="keyword">const</span> <span class="keywordflow">throw</span> () { <span class="keywordflow">return</span> m_Guest; }
00328 
<a name="l00329"></a><a class="code" href="classpqxx_1_1Unique.html#a2">00329</a>   <span class="keywordtype">void</span> <a class="code" href="classpqxx_1_1Unique.html#a2">Register</a>(GUEST *G)
00330   {
00331     <span class="keywordflow">if</span> (!G) <span class="keywordflow">throw</span> PGSTD::logic_error(<span class="stringliteral">"Internal libpqxx error: NULL "</span> + 
00332                                      <a class="code" href="namespacepqxx.html#a7">Classname</a>(G));
00333     
00334     <span class="keywordflow">if</span> (m_Guest)
00335     {
00336       <span class="keywordflow">if</span> (G == m_Guest)
00337         <span class="keywordflow">throw</span> PGSTD::logic_error(<a class="code" href="namespacepqxx.html#a7">Classname</a>(G) +
00338                                  <span class="stringliteral">" '"</span> +
00339                                  G-&gt;Name() +
00340                                  <span class="stringliteral">"' started more than once without closing"</span>);
00341 
00342       <span class="keywordflow">throw</span> PGSTD::logic_error(<span class="stringliteral">"Started "</span> + 
00343                                <a class="code" href="namespacepqxx.html#a7">Classname</a>(G) +
00344                                <span class="stringliteral">" '"</span> + 
00345                                G-&gt;Name() + 
00346                                <span class="stringliteral">"' while '"</span> +
00347                                m_Guest-&gt;Name() +
00348                                <span class="stringliteral">"' was still active"</span>);
00349     }
00350     
00351     m_Guest = G;
00352   }
00353 
<a name="l00354"></a><a class="code" href="classpqxx_1_1Unique.html#a3">00354</a>   <span class="keywordtype">void</span> <a class="code" href="classpqxx_1_1Unique.html#a3">Unregister</a>(GUEST *G)
00355   {
00356     <span class="keywordflow">if</span> (G != m_Guest)
00357     {
00358       <span class="keywordflow">if</span> (!G) 
00359         <span class="keywordflow">throw</span> PGSTD::logic_error(<span class="stringliteral">"Closing NULL "</span> + <a class="code" href="namespacepqxx.html#a7">Classname</a>(G));
00360       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!m_Guest)
00361         <span class="keywordflow">throw</span> PGSTD::logic_error(<span class="stringliteral">"Closing "</span> + 
00362                                  <a class="code" href="namespacepqxx.html#a7">Classname</a>(G) +
00363                                  <span class="stringliteral">" '"</span> +
00364                                  G-&gt;Name() +
00365                                  <span class="stringliteral">"' which wasn't open"</span>);
00366       <span class="keywordflow">else</span>
00367         <span class="keywordflow">throw</span> PGSTD::logic_error(<span class="stringliteral">"Closing wrong "</span> + 
00368                                  <a class="code" href="namespacepqxx.html#a7">Classname</a>(G) +
00369                                  <span class="stringliteral">"; expected '"</span> +
00370                                  m_Guest-&gt;Name() +
00371                                  <span class="stringliteral">"' but got '"</span> +
00372                                  G-&gt;Name() +
00373                                  <span class="stringliteral">"'"</span>);
00374     }
00375 
00376     m_Guest = 0;
00377   }
00378 
00379 <span class="keyword">private</span>:
00380   GUEST *m_Guest;
00381 
00382   <span class="comment">// Not allowed:</span>
00383   <a class="code" href="classpqxx_1_1Unique.html#a0">Unique</a>(<span class="keyword">const</span> Unique &amp;);
00384   <a class="code" href="classpqxx_1_1Unique.html#a0">Unique</a> &amp;operator=(<span class="keyword">const</span> Unique &amp;);
00385 };
00386 
00387 }
00388 
00389 <span class="preprocessor">#endif</span>
00390 <span class="preprocessor"></span>
</pre></div><hr><address style="align: right;"><small>Generated on Sat May 10 18:53:39 2003 for libpqxx by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
