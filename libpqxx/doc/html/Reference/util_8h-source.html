<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>util.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.16 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>util.h</h1><a href="util_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*-------------------------------------------------------------------------</font>
00002 <font class="comment"> *</font>
00003 <font class="comment"> *   FILE</font>
00004 <font class="comment"> *      pqxx/util.h</font>
00005 <font class="comment"> *</font>
00006 <font class="comment"> *   DESCRIPTION</font>
00007 <font class="comment"> *      Various utility definitions for libpqxx</font>
00008 <font class="comment"> *</font>
00009 <font class="comment"> * Copyright (c) 2001-2002, Jeroen T. Vermeulen &lt;jtv@xs4all.nl&gt;</font>
00010 <font class="comment"> *</font>
00011 <font class="comment"> *-------------------------------------------------------------------------</font>
00012 <font class="comment"> */</font>
00013 <font class="preprocessor">#ifndef PQXX_UTIL_H</font>
00014 <font class="preprocessor"></font><font class="preprocessor">#define PQXX_UTIL_H</font>
00015 <font class="preprocessor"></font>
00016 <font class="preprocessor">#include "<a class="code" href="compiler_8h.html">pqxx/compiler.h</a>"</font>
00017 
00018 <font class="preprocessor">#include &lt;cstdio&gt;</font>
00019 <font class="preprocessor">#include &lt;stdexcept&gt;</font>
00020 <font class="preprocessor">#include &lt;string&gt;</font>
00021 <font class="preprocessor">#include &lt;typeinfo&gt;</font>
00022 
00023 <font class="keyword">extern</font> <font class="stringliteral">"C"</font>
00024 {
00025 <font class="preprocessor">#include "libpq-fe.h"</font>
00026 }
00027 
00028 
00029 <font class="keyword">namespace </font>pqxx
00030 {
<a name="l00031"></a><a class="code" href="namespacepqxx.html#a1">00031</a> <font class="keyword">typedef</font> <font class="keywordtype">long</font> <a class="code" href="namespacepqxx.html#a1">Result_size_type</a>;
<a name="l00032"></a><a class="code" href="namespacepqxx.html#a2">00032</a> <font class="keyword">typedef</font> <font class="keywordtype">int</font> <a class="code" href="namespacepqxx.html#a2">Tuple_size_type</a>;
00033 
00036 <font class="keyword">template</font>&lt;<font class="keyword">typename</font> T&gt; <font class="keyword">inline</font> <font class="keyword">const</font> <font class="keywordtype">char</font> *<a class="code" href="namespacepqxx.html#a8">FmtString</a>(T);
00037 
00038 <font class="comment">// Not implemented to prevent accidents with irregular meaning of argument:</font>
00039 <font class="comment">// template&lt;&gt; inline const char *FmtString(const char *&amp;) { return "%s"; }</font>
00040 
<a name="l00041"></a><a class="code" href="namespacepqxx.html#a9">00041</a> <font class="keyword">template</font>&lt;&gt; <font class="keyword">inline</font> <font class="keyword">const</font> <font class="keywordtype">char</font> *<a class="code" href="namespacepqxx.html#a8">FmtString</a>(<font class="keywordtype">int</font>)           { <font class="keywordflow">return</font>  <font class="stringliteral">"%i"</font>; }
<a name="l00042"></a><a class="code" href="namespacepqxx.html#a10">00042</a> <font class="keyword">template</font>&lt;&gt; <font class="keyword">inline</font> <font class="keyword">const</font> <font class="keywordtype">char</font> *<a class="code" href="namespacepqxx.html#a8">FmtString</a>(<font class="keywordtype">long</font>)          { <font class="keywordflow">return</font> <font class="stringliteral">"%li"</font>; }
<a name="l00043"></a><a class="code" href="namespacepqxx.html#a11">00043</a> <font class="keyword">template</font>&lt;&gt; <font class="keyword">inline</font> <font class="keyword">const</font> <font class="keywordtype">char</font> *<a class="code" href="namespacepqxx.html#a8">FmtString</a>(<font class="keywordtype">unsigned</font>)      { <font class="keywordflow">return</font>  <font class="stringliteral">"%u"</font>; }
00044 <font class="keyword">template</font>&lt;&gt; <font class="keyword">inline</font> <font class="keyword">const</font> <font class="keywordtype">char</font> *<a class="code" href="namespacepqxx.html#a8">FmtString</a>(<font class="keywordtype">unsigned</font> <font class="keywordtype">long</font>) { <font class="keywordflow">return</font> <font class="stringliteral">"%lu"</font>; }
<a name="l00045"></a><a class="code" href="namespacepqxx.html#a12">00045</a> <font class="keyword">template</font>&lt;&gt; <font class="keyword">inline</font> <font class="keyword">const</font> <font class="keywordtype">char</font> *<a class="code" href="namespacepqxx.html#a8">FmtString</a>(<font class="keywordtype">float</font>)         { <font class="keywordflow">return</font>  <font class="stringliteral">"%f"</font>; }
<a name="l00046"></a><a class="code" href="namespacepqxx.html#a13">00046</a> <font class="keyword">template</font>&lt;&gt; <font class="keyword">inline</font> <font class="keyword">const</font> <font class="keywordtype">char</font> *<a class="code" href="namespacepqxx.html#a8">FmtString</a>(<font class="keywordtype">double</font>)        { <font class="keywordflow">return</font> <font class="stringliteral">"%lf"</font>; }
<a name="l00047"></a><a class="code" href="namespacepqxx.html#a14">00047</a> <font class="keyword">template</font>&lt;&gt; <font class="keyword">inline</font> <font class="keyword">const</font> <font class="keywordtype">char</font> *<a class="code" href="namespacepqxx.html#a8">FmtString</a>(<font class="keywordtype">char</font>)          { <font class="keywordflow">return</font>  <font class="stringliteral">"%c"</font>; }
00048 <font class="keyword">template</font>&lt;&gt; <font class="keyword">inline</font> <font class="keyword">const</font> <font class="keywordtype">char</font> *<a class="code" href="namespacepqxx.html#a8">FmtString</a>(<font class="keywordtype">unsigned</font> <font class="keywordtype">char</font>) { <font class="keywordflow">return</font>  <font class="stringliteral">"%c"</font>; }
00049 
00050 
<a name="l00052"></a><a class="code" href="namespacepqxx.html#a15">00052</a> <font class="keyword">template</font>&lt;<font class="keyword">typename</font> T&gt; <font class="keyword">inline</font> PGSTD::string <a class="code" href="namespacepqxx.html#a15">ToString</a>(<font class="keyword">const</font> T &amp;Obj)
00053 {
00054   <font class="comment">// TODO: Find a decent way to determine max string length at compile time!</font>
00055   <font class="keywordtype">char</font> Buf[500];
00056   sprintf(Buf, <a class="code" href="namespacepqxx.html#a8">FmtString</a>(Obj), Obj);
00057   <font class="keywordflow">return</font> PGSTD::string(Buf);
00058 }
00059 
<a name="l00060"></a><a class="code" href="namespacepqxx.html#a16">00060</a> <font class="keyword">template</font>&lt;&gt; <font class="keyword">inline</font> PGSTD::string <a class="code" href="namespacepqxx.html#a15">ToString</a>(<font class="keyword">const</font> PGSTD::string &amp;Obj) {<font class="keywordflow">return</font> Obj;}
<a name="l00061"></a><a class="code" href="namespacepqxx.html#a17">00061</a> <font class="keyword">template</font>&lt;&gt; <font class="keyword">inline</font> PGSTD::string <a class="code" href="namespacepqxx.html#a15">ToString</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *<font class="keyword">const</font> &amp;Obj) { <font class="keywordflow">return</font> Obj; }
00062 
<a name="l00063"></a><a class="code" href="namespacepqxx.html#a18">00063</a> <font class="keyword">template</font>&lt;&gt; <font class="keyword">inline</font> PGSTD::string <a class="code" href="namespacepqxx.html#a15">ToString</a>(<font class="keyword">const</font> <font class="keywordtype">bool</font> &amp;Obj) 
00064 { 
00065   <font class="keywordflow">return</font> <a class="code" href="namespacepqxx.html#a15">ToString</a>(<font class="keywordtype">unsigned</font>(Obj));
00066 }
00067 
<a name="l00068"></a><a class="code" href="namespacepqxx.html#a19">00068</a> <font class="keyword">template</font>&lt;&gt; <font class="keyword">inline</font> PGSTD::string <a class="code" href="namespacepqxx.html#a15">ToString</a>(<font class="keyword">const</font> <font class="keywordtype">short</font> &amp;Obj)
00069 {
00070   <font class="keywordflow">return</font> <a class="code" href="namespacepqxx.html#a15">ToString</a>(<font class="keywordtype">int</font>(Obj));
00071 }
00072 
<a name="l00073"></a><a class="code" href="namespacepqxx.html#a20">00073</a> <font class="keyword">template</font>&lt;&gt; <font class="keyword">inline</font> PGSTD::string <a class="code" href="namespacepqxx.html#a15">ToString</a>(<font class="keyword">const</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> &amp;Obj)
00074 {
00075   <font class="keywordflow">return</font> <a class="code" href="namespacepqxx.html#a15">ToString</a>(<font class="keywordtype">unsigned</font>(Obj));
00076 }
00077 
00078 
<a name="l00079"></a><a class="code" href="namespacepqxx.html#a21">00079</a> <font class="keyword">template</font>&lt;<font class="keyword">typename</font> T&gt; <font class="keyword">inline</font> <font class="keywordtype">void</font> <a class="code" href="namespacepqxx.html#a21">FromString</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> Str[], T &amp;Obj)
00080 {
00081   <font class="keywordflow">if</font> (!Str) <font class="keywordflow">throw</font> PGSTD::runtime_error(<font class="stringliteral">"Attempt to convert NULL string to "</font> +
00082                                      PGSTD::string(<font class="keyword">typeid</font>(T).name()));
00083 
00084   <font class="keywordflow">if</font> (sscanf(Str, <a class="code" href="namespacepqxx.html#a8">FmtString</a>(Obj), &amp;Obj) != 1)
00085     <font class="keywordflow">throw</font> PGSTD::runtime_error(<font class="stringliteral">"Cannot convert value '"</font> + 
00086                              PGSTD::string(Str) + 
00087                              <font class="stringliteral">"' to "</font> + <font class="keyword">typeid</font>(T).name());
00088 }
00089 
00090 
<a name="l00091"></a><a class="code" href="namespacepqxx.html#a22">00091</a> <font class="keyword">template</font>&lt;&gt; <font class="keyword">inline</font> <font class="keywordtype">void</font> <a class="code" href="namespacepqxx.html#a21">FromString</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> Str[], PGSTD::string &amp;Obj)
00092 {
00093   <font class="keywordflow">if</font> (!Str) 
00094     <font class="keywordflow">throw</font> PGSTD::runtime_error(<font class="stringliteral">"Attempt to convert NULL C string to C++ string"</font>);
00095   Obj = Str;
00096 }
00097 
00098 
<a name="l00099"></a><a class="code" href="namespacepqxx.html#a23">00099</a> <font class="keyword">template</font>&lt;&gt; <font class="keyword">inline</font> <font class="keywordtype">void</font> <a class="code" href="namespacepqxx.html#a21">FromString</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> Str[], <font class="keyword">const</font> <font class="keywordtype">char</font> *&amp;Obj)
00100 {
00101   <font class="keywordflow">if</font> (!Str)
00102     <font class="keywordflow">throw</font> PGSTD::runtime_error(<font class="stringliteral">"Attempt to read NULL string"</font>);
00103   Obj = Str;
00104 }
00105 
<a name="l00106"></a><a class="code" href="namespacepqxx.html#a24">00106</a> <font class="keyword">template</font>&lt;&gt; <font class="keyword">inline</font> <font class="keywordtype">void</font> <a class="code" href="namespacepqxx.html#a21">FromString</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> Str[], <font class="keywordtype">bool</font> &amp;Obj)
00107 {
00108   <font class="keywordflow">if</font> (!Str)
00109     <font class="keywordflow">throw</font> PGSTD::runtime_error(<font class="stringliteral">"Attempt to read NULL string"</font>);
00110 
00111   <font class="keywordflow">switch</font> (Str[0])
00112   {
00113   <font class="keywordflow">case</font> 0:
00114   <font class="keywordflow">case</font> <font class="charliteral">'f'</font>:
00115     Obj = <font class="keyword">false</font>;
00116     <font class="keywordflow">break</font>;
00117   <font class="keywordflow">case</font> <font class="charliteral">'0'</font>:
00118     {
00119       <font class="keywordtype">int</font> I;
00120       <a class="code" href="namespacepqxx.html#a21">FromString</a>(Str, I);
00121       Obj = (I != 0);
00122     }
00123     <font class="keywordflow">break</font>;
00124   <font class="keywordflow">default</font>:
00125     Obj = <font class="keyword">true</font>;
00126   }
00127 }
00128 
00129 
00132 <font class="keyword">template</font>&lt;<font class="keyword">typename</font> T&gt; PGSTD::string <a class="code" href="namespacepqxx.html#a25">Quote</a>(<font class="keyword">const</font> T &amp;Obj, <font class="keywordtype">bool</font> EmptyIsNull=<font class="keyword">false</font>);
00133 
00134 
<a name="l00136"></a><a class="code" href="namespacepqxx.html#a26">00136</a> <font class="keyword">template</font>&lt;&gt; <font class="keyword">inline</font> PGSTD::string <a class="code" href="namespacepqxx.html#a25">Quote</a>(<font class="keyword">const</font> PGSTD::string &amp;Obj, 
00137                                       <font class="keywordtype">bool</font> EmptyIsNull)
00138 {
00139     <font class="keywordflow">if</font> (EmptyIsNull &amp;&amp; Obj.empty())
00140         <font class="keywordflow">return</font> <font class="stringliteral">"null"</font>;
00141 
00142     PGSTD::string <a class="code" href="classpqxx_1_1Result.html">Result</a> = <font class="stringliteral">"'"</font> + Obj;
00143     <font class="keyword">const</font> <font class="keywordtype">char</font> Special[] = <font class="stringliteral">"'\\"</font>;
00144     <font class="keywordflow">for</font> (PGSTD::string::size_type i = <a class="code" href="classpqxx_1_1Result.html">Result</a>.find_last_of(Special);
00145          i &gt; 0;
00146          i = <a class="code" href="classpqxx_1_1Result.html">Result</a>.find_last_of(Special, i))
00147       <a class="code" href="classpqxx_1_1Result.html">Result</a>.insert(i, 1, <a class="code" href="classpqxx_1_1Result.html">Result</a>[i]);
00148 
00149     <font class="keywordflow">return</font> <a class="code" href="classpqxx_1_1Result.html">Result</a> + <font class="stringliteral">"'"</font>;
00150 }
00151 
00152 
<a name="l00155"></a><a class="code" href="namespacepqxx.html#a27">00155</a> <font class="keyword">template</font>&lt;&gt; <font class="keyword">inline</font> PGSTD::string <a class="code" href="namespacepqxx.html#a25">Quote</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *<font class="keyword">const</font> &amp; Obj, 
00156                                       <font class="keywordtype">bool</font> EmptyIsNull)
00157 {
00158   <font class="keywordflow">if</font> (!Obj) <font class="keywordflow">return</font> <font class="stringliteral">"null"</font>;
00159   <font class="keywordflow">return</font> <a class="code" href="namespacepqxx.html#a25">Quote</a>(PGSTD::string(Obj), EmptyIsNull);
00160 }
00161 
00162 
<a name="l00166"></a><a class="code" href="namespacepqxx.html#a25">00166</a> <font class="keyword">template</font>&lt;<font class="keyword">typename</font> T&gt; <font class="keyword">inline</font> PGSTD::string <a class="code" href="namespacepqxx.html#a25">Quote</a>(<font class="keyword">const</font> T &amp;Obj, <font class="keywordtype">bool</font> EmptyIsNull)
00167 {
00168   <font class="keywordflow">return</font> <a class="code" href="namespacepqxx.html#a25">Quote</a>(<a class="code" href="namespacepqxx.html#a15">ToString</a>(Obj), EmptyIsNull);
00169 }
00170 
00171 
00172 
00174 <font class="keyword">template</font>&lt;<font class="keyword">typename</font> T&gt; PGSTD::string <a class="code" href="namespacepqxx.html#a5">Classname</a>(<font class="keyword">const</font> T *);
00175 
00176 
00182 <font class="keyword">template</font>&lt;<font class="keyword">typename</font> GUEST&gt;
<a name="l00183"></a><a class="code" href="classpqxx_1_1Unique.html">00183</a> <font class="keyword">class </font><a class="code" href="classpqxx_1_1Unique.html">Unique</a>
00184 {
00185 <font class="keyword">public</font>:
<a name="l00186"></a><a class="code" href="classpqxx_1_1Unique.html#a0">00186</a>   <a class="code" href="classpqxx_1_1Unique.html#a0">Unique</a>() : m_Guest(0) {}
00187 
<a name="l00188"></a><a class="code" href="classpqxx_1_1Unique.html#a1">00188</a>   <font class="keyword">const</font> GUEST *<a class="code" href="classpqxx_1_1Unique.html#a1">get</a>() <font class="keyword">const</font> <font class="keywordflow">throw</font> () { <font class="keywordflow">return</font> m_Guest; }
00189 
<a name="l00190"></a><a class="code" href="classpqxx_1_1Unique.html#a2">00190</a>   <font class="keywordtype">void</font> <a class="code" href="classpqxx_1_1Unique.html#a2">Register</a>(<font class="keyword">const</font> GUEST *G)
00191   {
00192     <font class="keywordflow">if</font> (!G) <font class="keywordflow">throw</font> PGSTD::logic_error(<font class="stringliteral">"Internal libpqxx error: NULL "</font> + 
00193                                      <a class="code" href="namespacepqxx.html#a5">Classname</a>(G));
00194     
00195     <font class="keywordflow">if</font> (m_Guest)
00196     {
00197       <font class="keywordflow">if</font> (G == m_Guest)
00198         <font class="keywordflow">throw</font> PGSTD::logic_error(<a class="code" href="namespacepqxx.html#a5">Classname</a>(G) +
00199                                  <font class="stringliteral">" '"</font> +
00200                                  G-&gt;Name() +
00201                                  <font class="stringliteral">"' started more than once without closing"</font>);
00202 
00203       <font class="keywordflow">throw</font> PGSTD::logic_error(<font class="stringliteral">"Started "</font> + 
00204                                <a class="code" href="namespacepqxx.html#a5">Classname</a>(G) +
00205                                <font class="stringliteral">" '"</font> + 
00206                                G-&gt;Name() + 
00207                                <font class="stringliteral">"' while '"</font> +
00208                                m_Guest-&gt;Name() +
00209                                <font class="stringliteral">"' was still active"</font>);
00210     }
00211     
00212     m_Guest = G;
00213   }
00214 
<a name="l00215"></a><a class="code" href="classpqxx_1_1Unique.html#a3">00215</a>   <font class="keywordtype">void</font> <a class="code" href="classpqxx_1_1Unique.html#a3">Unregister</a>(<font class="keyword">const</font> GUEST *G)
00216   {
00217     <font class="keywordflow">if</font> (G != m_Guest)
00218     {
00219       <font class="keywordflow">if</font> (!G) 
00220         <font class="keywordflow">throw</font> PGSTD::logic_error(<font class="stringliteral">"Closing NULL "</font> + <a class="code" href="namespacepqxx.html#a5">Classname</a>(G));
00221       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!m_Guest)
00222         <font class="keywordflow">throw</font> PGSTD::logic_error(<font class="stringliteral">"Closing "</font> + 
00223                                  <a class="code" href="namespacepqxx.html#a5">Classname</a>(G) +
00224                                  <font class="stringliteral">" '"</font> +
00225                                  G-&gt;Name() +
00226                                  <font class="stringliteral">"' which wasn't open"</font>);
00227       <font class="keywordflow">else</font>
00228         <font class="keywordflow">throw</font> PGSTD::logic_error(<font class="stringliteral">"Closing wrong "</font> + 
00229                                  <a class="code" href="namespacepqxx.html#a5">Classname</a>(G) +
00230                                  <font class="stringliteral">"; expected '"</font> +
00231                                  m_Guest-&gt;Name() +
00232                                  <font class="stringliteral">"' but got '"</font> +
00233                                  G-&gt;Name() +
00234                                  <font class="stringliteral">"'"</font>);
00235     }
00236 
00237     m_Guest = 0;
00238   }
00239 
00240 <font class="keyword">private</font>:
00241   <font class="keyword">const</font> GUEST *m_Guest;
00242 
00243   <font class="comment">// Not allowed:</font>
00244   <a class="code" href="classpqxx_1_1Unique.html#a0">Unique</a>(<font class="keyword">const</font> <a class="code" href="classpqxx_1_1Unique.html#a0">Unique</a> &amp;);
00245   <a class="code" href="classpqxx_1_1Unique.html#a0">Unique</a> &amp;operator=(<font class="keyword">const</font> <a class="code" href="classpqxx_1_1Unique.html#a0">Unique</a> &amp;);
00246 };
00247 
00248 
<a name="l00249"></a><a class="code" href="namespacepqxx.html#a3">00249</a> <font class="keyword">const</font> <a class="code" href="namespacepqxx.html#a1">Result_size_type</a> <a class="code" href="namespacepqxx.html#a3">Result_size_type_min</a> =
00250   <a class="code" href="structPGSTD_1_1numeric__limits.html#d1">PGSTD::numeric_limits&lt;Result_size_type&gt;::min</a>();
<a name="l00251"></a><a class="code" href="namespacepqxx.html#a4">00251</a> <font class="keyword">const</font> <a class="code" href="namespacepqxx.html#a1">Result_size_type</a> <a class="code" href="namespacepqxx.html#a4">Result_size_type_max</a> =
00252   <a class="code" href="structPGSTD_1_1numeric__limits.html#d0">PGSTD::numeric_limits&lt;Result_size_type&gt;::max</a>();
00253 
00254 }
00255 
00256 <font class="preprocessor">#endif</font>
00257 <font class="preprocessor"></font>
</pre></div><hr><address align="right"><small>Generated on Mon Sep 23 01:20:26 2002 for libpqxx by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.16 </small></address>
</body>
</html>
