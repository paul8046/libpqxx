<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>util.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>util.h</h1><a href="util_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*-------------------------------------------------------------------------</span>
00002 <span class="comment"> *</span>
00003 <span class="comment"> *   FILE</span>
00004 <span class="comment"> *      pqxx/util.h</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> *   DESCRIPTION</span>
00007 <span class="comment"> *      Various utility definitions for libpqxx</span>
00008 <span class="comment"> *</span>
00009 <span class="comment"> * Copyright (c) 2001-2003, Jeroen T. Vermeulen &lt;jtv@xs4all.nl&gt;</span>
00010 <span class="comment"> *</span>
00011 <span class="comment"> * See COPYING for copyright license.  If you did not receive a file called</span>
00012 <span class="comment"> * COPYING with this source code, please notify the distributor of this mistake,</span>
00013 <span class="comment"> * or contact the author.</span>
00014 <span class="comment"> *</span>
00015 <span class="comment"> *-------------------------------------------------------------------------</span>
00016 <span class="comment"> */</span>
00017 <span class="preprocessor">#ifndef PQXX_UTIL_H</span>
00018 <span class="preprocessor"></span><span class="preprocessor">#define PQXX_UTIL_H</span>
00019 <span class="preprocessor"></span>
00020 <span class="preprocessor">#include "<a class="code" href="compiler_8h.html">pqxx/compiler.h</a>"</span>
00021 
00022 <span class="preprocessor">#include &lt;cstdio&gt;</span>
00023 <span class="preprocessor">#include &lt;stdexcept&gt;</span>
00024 <span class="preprocessor">#include &lt;string&gt;</span>
00025 <span class="preprocessor">#include &lt;typeinfo&gt;</span>
00026 
00027 <span class="keyword">extern</span> <span class="stringliteral">"C"</span>
00028 {
00029 <span class="preprocessor">#include "libpq-fe.h"</span>
00030 }
00031 
00032 
00033 <span class="keyword">namespace </span>pqxx
00034 {
<a name="l00035"></a><a class="code" href="namespacepqxx.html#a22">00035</a> <span class="keyword">typedef</span> <span class="keywordtype">long</span> <a class="code" href="namespacepqxx.html#a22">result_size_type</a>;
<a name="l00036"></a><a class="code" href="namespacepqxx.html#a23">00036</a> <span class="keyword">typedef</span> <span class="keywordtype">int</span> <a class="code" href="namespacepqxx.html#a23">tuple_size_type</a>;
00037 
<a name="l00039"></a><a class="code" href="namespacepqxx.html#a24">00039</a> <span class="keyword">typedef</span> Oid <a class="code" href="namespacepqxx.html#a24">oid</a>;
00040 
<a name="l00042"></a><a class="code" href="namespacepqxx.html#a25">00042</a> <span class="keyword">const</span> <a class="code" href="namespacepqxx.html#a24">oid</a> <a class="code" href="namespacepqxx.html#a25">oid_none</a> = InvalidOid;
00043 
00044 
00047 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="namespacepqxx.html#a36">FmtString</a>(T);
00048 
00049 <span class="comment">// Not implemented to prevent accidents with irregular meaning of argument:</span>
00050 <span class="comment">// template&lt;&gt; inline const char *FmtString(const char *&amp;) { return "%s"; }</span>
00051 
<a name="l00052"></a><a class="code" href="namespacepqxx.html#a37">00052</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="namespacepqxx.html#a36">FmtString</a>(<span class="keywordtype">short</span>)         { <span class="keywordflow">return</span> <span class="stringliteral">"%hd"</span>; }
<a name="l00053"></a><a class="code" href="namespacepqxx.html#a38">00053</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="namespacepqxx.html#a36">FmtString</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>){ <span class="keywordflow">return</span> <span class="stringliteral">"%hu"</span>; }
<a name="l00054"></a><a class="code" href="namespacepqxx.html#a39">00054</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="namespacepqxx.html#a36">FmtString</a>(<span class="keywordtype">int</span>)           { <span class="keywordflow">return</span>  <span class="stringliteral">"%i"</span>; }
<a name="l00055"></a><a class="code" href="namespacepqxx.html#a40">00055</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="namespacepqxx.html#a36">FmtString</a>(<span class="keywordtype">long</span>)          { <span class="keywordflow">return</span> <span class="stringliteral">"%li"</span>; }
00056 <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="namespacepqxx.html#a36">FmtString</a>(<span class="keywordtype">unsigned</span>)      { <span class="keywordflow">return</span>  <span class="stringliteral">"%u"</span>; }
00057 <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="namespacepqxx.html#a36">FmtString</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) { <span class="keywordflow">return</span> <span class="stringliteral">"%lu"</span>; }
<a name="l00058"></a><a class="code" href="namespacepqxx.html#a41">00058</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="namespacepqxx.html#a36">FmtString</a>(<span class="keywordtype">float</span>)         { <span class="keywordflow">return</span>  <span class="stringliteral">"%f"</span>; }
<a name="l00059"></a><a class="code" href="namespacepqxx.html#a42">00059</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="namespacepqxx.html#a36">FmtString</a>(<span class="keywordtype">double</span>)        { <span class="keywordflow">return</span> <span class="stringliteral">"%lf"</span>; }
00060 <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="namespacepqxx.html#a36">FmtString</a>(<span class="keywordtype">long</span> <span class="keywordtype">double</span>)   { <span class="keywordflow">return</span> <span class="stringliteral">"%Lf"</span>; }
<a name="l00061"></a><a class="code" href="namespacepqxx.html#a43">00061</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="namespacepqxx.html#a36">FmtString</a>(<span class="keywordtype">char</span>)          { <span class="keywordflow">return</span>  <span class="stringliteral">"%c"</span>; }
00062 <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="namespacepqxx.html#a36">FmtString</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>) { <span class="keywordflow">return</span>  <span class="stringliteral">"%c"</span>; }
00063 
00064 
00066 
<a name="l00073"></a><a class="code" href="namespacepqxx.html#a44">00073</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> PGSTD::string <a class="code" href="namespacepqxx.html#a44">ToString</a>(<span class="keyword">const</span> T &amp;Obj)
00074 {
00075   <span class="comment">// TODO: Find a decent way to determine max string length at compile time!</span>
00076   <span class="keywordtype">char</span> Buf[500];
00077   sprintf(Buf, <a class="code" href="namespacepqxx.html#a36">FmtString</a>(Obj), Obj);
00078   <span class="keywordflow">return</span> PGSTD::string(Buf);
00079 }
00080 
00081 <span class="comment">// TODO: Implement date conversions</span>
00082 
<a name="l00083"></a><a class="code" href="namespacepqxx.html#a45">00083</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> PGSTD::string <a class="code" href="namespacepqxx.html#a44">ToString</a>(<span class="keyword">const</span> PGSTD::string &amp;Obj) {<span class="keywordflow">return</span> Obj;}
<a name="l00084"></a><a class="code" href="namespacepqxx.html#a46">00084</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> PGSTD::string <a class="code" href="namespacepqxx.html#a44">ToString</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> &amp;Obj) { <span class="keywordflow">return</span> Obj; }
<a name="l00085"></a><a class="code" href="namespacepqxx.html#a47">00085</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> PGSTD::string <a class="code" href="namespacepqxx.html#a44">ToString</a>(<span class="keywordtype">char</span> *<span class="keyword">const</span> &amp;Obj) { <span class="keywordflow">return</span> Obj; }
00086 
<a name="l00087"></a><a class="code" href="namespacepqxx.html#a48">00087</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> PGSTD::string <a class="code" href="namespacepqxx.html#a44">ToString</a>(<span class="keyword">const</span> <span class="keywordtype">bool</span> &amp;Obj) 
00088 { 
00089   <span class="keywordflow">return</span> <a class="code" href="namespacepqxx.html#a44">ToString</a>(<span class="keywordtype">unsigned</span>(Obj));
00090 }
00091 
<a name="l00092"></a><a class="code" href="namespacepqxx.html#a49">00092</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> PGSTD::string <a class="code" href="namespacepqxx.html#a44">ToString</a>(<span class="keyword">const</span> <span class="keywordtype">short</span> &amp;Obj)
00093 {
00094   <span class="keywordflow">return</span> <a class="code" href="namespacepqxx.html#a44">ToString</a>(<span class="keywordtype">int</span>(Obj));
00095 }
00096 
<a name="l00097"></a><a class="code" href="namespacepqxx.html#a50">00097</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> PGSTD::string <a class="code" href="namespacepqxx.html#a44">ToString</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> &amp;Obj)
00098 {
00099   <span class="keywordflow">return</span> <a class="code" href="namespacepqxx.html#a44">ToString</a>(<span class="keywordtype">unsigned</span>(Obj));
00100 }
00101 
00102 
00104 
<a name="l00111"></a><a class="code" href="namespacepqxx.html#a51">00111</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="namespacepqxx.html#a51">FromString</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> Str[], T &amp;Obj)
00112 {
00113   <span class="keywordflow">if</span> (!Str) <span class="keywordflow">throw</span> PGSTD::runtime_error(<span class="stringliteral">"Attempt to convert NULL string to "</span> +
00114                                      PGSTD::string(<span class="keyword">typeid</span>(T).name()));
00115 
00116   <span class="keywordflow">if</span> (sscanf(Str, <a class="code" href="namespacepqxx.html#a36">FmtString</a>(Obj), &amp;Obj) != 1)
00117     <span class="keywordflow">throw</span> PGSTD::runtime_error(<span class="stringliteral">"Cannot convert value '"</span> + 
00118                              PGSTD::string(Str) + 
00119                              <span class="stringliteral">"' to "</span> + <span class="keyword">typeid</span>(T).name());
00120 }
00121 
00122 
<a name="l00123"></a><a class="code" href="namespacepqxx.html#a52">00123</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="namespacepqxx.html#a51">FromString</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> Str[], PGSTD::string &amp;Obj)
00124 {
00125   <span class="keywordflow">if</span> (!Str) 
00126     <span class="keywordflow">throw</span> PGSTD::runtime_error(<span class="stringliteral">"Attempt to convert NULL C string to C++ "</span>
00127                                <span class="stringliteral">"string"</span>);
00128   Obj = Str;
00129 }
00130 
00131 
<a name="l00132"></a><a class="code" href="namespacepqxx.html#a53">00132</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="namespacepqxx.html#a51">FromString</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> Str[], <span class="keyword">const</span> <span class="keywordtype">char</span> *&amp;Obj)
00133 {
00134   <span class="keywordflow">if</span> (!Str)
00135     <span class="keywordflow">throw</span> PGSTD::runtime_error(<span class="stringliteral">"Attempt to read NULL string"</span>);
00136   Obj = Str;
00137 }
00138 
<a name="l00139"></a><a class="code" href="namespacepqxx.html#a54">00139</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="namespacepqxx.html#a51">FromString</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> Str[], <span class="keywordtype">bool</span> &amp;Obj)
00140 {
00141   <span class="keywordflow">if</span> (!Str)
00142     <span class="keywordflow">throw</span> PGSTD::runtime_error(<span class="stringliteral">"Attempt to read NULL string"</span>);
00143 
00144   <span class="keywordflow">switch</span> (Str[0])
00145   {
00146   <span class="keywordflow">case</span> 0:
00147   <span class="keywordflow">case</span> <span class="charliteral">'f'</span>:
00148     Obj = <span class="keyword">false</span>;
00149     <span class="keywordflow">break</span>;
00150   <span class="keywordflow">case</span> <span class="charliteral">'0'</span>:
00151     {
00152       <span class="keywordtype">int</span> I;
00153       <a class="code" href="namespacepqxx.html#a51">FromString</a>(Str, I);
00154       Obj = (I != 0);
00155     }
00156     <span class="keywordflow">break</span>;
00157   <span class="keywordflow">default</span>:
00158     Obj = <span class="keyword">true</span>;
00159   }
00160 }
00161 
00162 
00164 
00167 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> PGSTD::string <a class="code" href="namespacepqxx.html#a55">Quote</a>(<span class="keyword">const</span> T &amp;Obj, <span class="keywordtype">bool</span> EmptyIsNull);
00168 
<a name="l00170"></a><a class="code" href="namespacepqxx.html#a56">00170</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> PGSTD::string <a class="code" href="namespacepqxx.html#a55">Quote</a>(<span class="keyword">const</span> PGSTD::string &amp;Obj, 
00171                                       <span class="keywordtype">bool</span> EmptyIsNull)
00172 {
00173   <span class="keywordflow">if</span> (EmptyIsNull &amp;&amp; Obj.empty()) <span class="keywordflow">return</span> <span class="stringliteral">"null"</span>;
00174 
00175   PGSTD::string <a class="code" href="classpqxx_1_1result.html">Result</a>;
00176   <a class="code" href="namespacepqxx.html#a13">Result</a>.reserve(Obj.size() + 2);
00177   <a class="code" href="namespacepqxx.html#a13">Result</a> += <span class="stringliteral">"'"</span>;
00178 
00179 <span class="preprocessor">#ifdef HAVE_PQESCAPESTRING</span>
00180 <span class="preprocessor"></span>
00181   <span class="keywordtype">char</span> *<span class="keyword">const</span> Buf = <span class="keyword">new</span> <span class="keywordtype">char</span>[2*Obj.<a class="code" href="classpqxx_1_1result.html#a6">size</a>() + 1];
00182   <span class="keywordflow">try</span>
00183   {
00184     PQescapeString(Buf, Obj.c_str(), Obj.size());
00185     <a class="code" href="namespacepqxx.html#a13">Result</a> += Buf;
00186   }
00187   <span class="keywordflow">catch</span> (<span class="keyword">const</span> PGSTD::exception &amp;)
00188   {
00189     <span class="keyword">delete</span> [] Buf;
00190     <span class="keywordflow">throw</span>;
00191   }
00192   <span class="keyword">delete</span> [] Buf;
00193 
00194 <span class="preprocessor">#else</span>
00195 <span class="preprocessor"></span>
00196   <span class="keywordflow">for</span> (PGSTD::string::size_type i=0; i &lt; Obj.size(); ++i)
00197   {
00198     <span class="keywordflow">if</span> (isgraph(Obj[i]))
00199     {
00200       <span class="keywordflow">switch</span> (Obj[i])
00201       {
00202       <span class="keywordflow">case</span> <span class="charliteral">'\''</span>:
00203       <span class="keywordflow">case</span> <span class="charliteral">'\\'</span>:
00204         <a class="code" href="namespacepqxx.html#a13">Result</a> += <span class="charliteral">'\\'</span>;
00205       }
00206       <a class="code" href="namespacepqxx.html#a13">Result</a> += Obj[i];
00207     }
00208     <span class="keywordflow">else</span>
00209     {
00210         <span class="keywordtype">char</span> s[10];
00211         sprintf(s, 
00212                 <span class="stringliteral">"\\%03o"</span>, 
00213                 static_cast&lt;unsigned int&gt;(static_cast&lt;unsigned char&gt;(Obj[i])));
00214         <a class="code" href="namespacepqxx.html#a13">Result</a>.append(s, 4);
00215     }
00216   }
00217 
00218 <span class="preprocessor">#endif</span>
00219 <span class="preprocessor"></span>
00220   <span class="keywordflow">return</span> <a class="code" href="namespacepqxx.html#a13">Result</a> + <span class="charliteral">'\''</span>;
00221 }
00222 
00223 
<a name="l00226"></a><a class="code" href="namespacepqxx.html#a57">00226</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">inline</span> PGSTD::string <a class="code" href="namespacepqxx.html#a55">Quote</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> &amp; Obj, 
00227                                       <span class="keywordtype">bool</span> EmptyIsNull)
00228 {
00229   <span class="keywordflow">if</span> (!Obj) <span class="keywordflow">return</span> <span class="stringliteral">"null"</span>;
00230   <span class="keywordflow">return</span> <a class="code" href="namespacepqxx.html#a55">Quote</a>(PGSTD::string(Obj), EmptyIsNull);
00231 }
00232 
00233 
00235 
<a name="l00240"></a><a class="code" href="namespacepqxx.html#a58">00240</a> <span class="keyword">template</span>&lt;<span class="keywordtype">int</span> LEN&gt; <span class="keyword">inline</span> PGSTD::string <a class="code" href="namespacepqxx.html#a55">Quote</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> (&amp;Obj)[LEN],
00241                                              <span class="keywordtype">bool</span> EmptyIsNull)          <span class="comment">//[t18]</span>
00242 {
00243   <span class="keywordflow">return</span> <a class="code" href="namespacepqxx.html#a55">Quote</a>(PGSTD::string(Obj), EmptyIsNull);
00244 }
00245 
00246 
<a name="l00250"></a><a class="code" href="namespacepqxx.html#a55">00250</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> PGSTD::string <a class="code" href="namespacepqxx.html#a55">Quote</a>(<span class="keyword">const</span> T &amp;Obj, <span class="keywordtype">bool</span> EmptyIsNull)
00251 {
00252   <span class="keywordflow">return</span> <a class="code" href="namespacepqxx.html#a55">Quote</a>(<a class="code" href="namespacepqxx.html#a44">ToString</a>(Obj), EmptyIsNull);
00253 }
00254 
00255 
00257 
<a name="l00259"></a><a class="code" href="namespacepqxx.html#a59">00259</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> PGSTD::string <a class="code" href="namespacepqxx.html#a55">Quote</a>(T Obj)
00260 {
00261   <span class="keywordflow">return</span> <a class="code" href="namespacepqxx.html#a55">Quote</a>(Obj, <span class="keyword">false</span>);
00262 }
00263 
00264 
00265 
00267 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; PGSTD::string <a class="code" href="namespacepqxx.html#a26">Classname</a>(<span class="keyword">const</span> T *);
00268 
00269 
00271 
<a name="l00276"></a><a class="code" href="classpqxx_1_1PQAlloc.html">00276</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">class </span>PQXX_LIBEXPORT PQAlloc
00277 {
00278   T *m_Obj;
00279 <span class="keyword">public</span>:
<a name="l00280"></a><a class="code" href="classpqxx_1_1PQAlloc.html#a0">00280</a>   PQAlloc() : m_Obj(0) {}
00281 
<a name="l00283"></a><a class="code" href="classpqxx_1_1PQAlloc.html#a1">00283</a>   <span class="keyword">explicit</span> PQAlloc(T *obj) : m_Obj(obj) {}
00284 
<a name="l00285"></a><a class="code" href="classpqxx_1_1PQAlloc.html#a2">00285</a>   ~PQAlloc() { close(); }
00286 
00288 
<a name="l00290"></a><a class="code" href="classpqxx_1_1PQAlloc.html#a3">00290</a>   PQAlloc &amp;operator=(T *obj) <span class="keywordflow">throw</span> ()
00291   { 
00292     <span class="keywordflow">if</span> (obj != m_Obj)
00293     {
00294       close();
00295       m_Obj = obj;
00296     }
00297     <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00298   }
00299 
<a name="l00301"></a><a class="code" href="classpqxx_1_1PQAlloc.html#a4">00301</a>   operator bool() <span class="keyword">const</span> <span class="keywordflow">throw</span> () { <span class="keywordflow">return</span> m_Obj != 0; }
00302 
<a name="l00304"></a><a class="code" href="classpqxx_1_1PQAlloc.html#a5">00304</a>   <span class="keywordtype">bool</span> operator!() <span class="keyword">const</span> <span class="keywordflow">throw</span> () { <span class="keywordflow">return</span> !m_Obj; }
00305 
00307 
<a name="l00309"></a><a class="code" href="classpqxx_1_1PQAlloc.html#a6">00309</a>   T *operator-&gt;() <span class="keyword">const</span> <span class="keywordflow">throw</span> (PGSTD::logic_error)
00310   {
00311     <span class="keywordflow">if</span> (!m_Obj) <span class="keywordflow">throw</span> PGSTD::logic_error(<span class="stringliteral">"Null pointer dereferenced"</span>);
00312     <span class="keywordflow">return</span> m_Obj;
00313   }
00314 
00316 
<a name="l00318"></a><a class="code" href="classpqxx_1_1PQAlloc.html#a7">00318</a>   T &amp;operator*() <span class="keyword">const</span> <span class="keywordflow">throw</span> (PGSTD::logic_error) { <span class="keywordflow">return</span> *operator-&gt;(); }
00319 
00321 
<a name="l00323"></a><a class="code" href="classpqxx_1_1PQAlloc.html#a8">00323</a>   T *c_ptr() <span class="keyword">const</span> <span class="keywordflow">throw</span> () { <span class="keywordflow">return</span> m_Obj; }
00324 
<a name="l00326"></a><a class="code" href="classpqxx_1_1PQAlloc.html#a9">00326</a>   <span class="keywordtype">void</span> close() <span class="keywordflow">throw</span> () { <span class="keywordflow">if</span> (m_Obj) freemem(); m_Obj = 0; }
00327 
00328 <span class="keyword">private</span>:
00329   <span class="keywordtype">void</span> freemem() <span class="keywordflow">throw</span> ()
00330   {
00331 <span class="preprocessor">#ifdef HAVE_PQFREEMEM</span>
00332 <span class="preprocessor"></span>    PQfreemem(reinterpret_cast&lt;unsigned char *&gt;(m_Obj));
00333 <span class="preprocessor">#else</span>
00334 <span class="preprocessor"></span>    free(m_Obj);
00335 <span class="preprocessor">#endif</span>
00336 <span class="preprocessor"></span>  }
00337 
00338   PQAlloc(<span class="keyword">const</span> PQAlloc &amp;);             <span class="comment">// Not allowed</span>
00339   PQAlloc &amp;operator=(<span class="keyword">const</span> PQAlloc &amp;);  <span class="comment">// Not allowed</span>
00340 };
00341 
00342 
00343 
00349 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> GUEST&gt;
<a name="l00350"></a><a class="code" href="classpqxx_1_1unique.html">00350</a> <span class="keyword">class </span>PQXX_LIBEXPORT unique
00351 {
00352 <span class="keyword">public</span>:
<a name="l00353"></a><a class="code" href="classpqxx_1_1unique.html#a0">00353</a>   unique() : m_Guest(0) {}
00354 
<a name="l00355"></a><a class="code" href="classpqxx_1_1unique.html#a1">00355</a>   GUEST *get() <span class="keyword">const</span> <span class="keywordflow">throw</span> () { <span class="keywordflow">return</span> m_Guest; }
00356 
<a name="l00357"></a><a class="code" href="classpqxx_1_1unique.html#a2">00357</a>   <span class="keywordtype">void</span> Register(GUEST *G)
00358   {
00359     <span class="keywordflow">if</span> (!G) <span class="keywordflow">throw</span> PGSTD::logic_error(<span class="stringliteral">"Internal libpqxx error: NULL "</span> + 
00360                                      <a class="code" href="namespacepqxx.html#a26">Classname</a>(G));
00361     
00362     <span class="keywordflow">if</span> (m_Guest)
00363     {
00364       <span class="keywordflow">if</span> (G == m_Guest)
00365         <span class="keywordflow">throw</span> PGSTD::logic_error(<a class="code" href="namespacepqxx.html#a26">Classname</a>(G) +
00366                                  <span class="stringliteral">" '"</span> +
00367                                  G-&gt;Name() +
00368                                  <span class="stringliteral">"' started more than once without closing"</span>);
00369 
00370       <span class="keywordflow">throw</span> PGSTD::logic_error(<span class="stringliteral">"Started "</span> + 
00371                                <a class="code" href="namespacepqxx.html#a26">Classname</a>(G) +
00372                                <span class="stringliteral">" '"</span> + 
00373                                G-&gt;Name() + 
00374                                <span class="stringliteral">"' while '"</span> +
00375                                m_Guest-&gt;Name() +
00376                                <span class="stringliteral">"' was still active"</span>);
00377     }
00378     
00379     m_Guest = G;
00380   }
00381 
<a name="l00382"></a><a class="code" href="classpqxx_1_1unique.html#a3">00382</a>   <span class="keywordtype">void</span> Unregister(GUEST *G)
00383   {
00384     <span class="keywordflow">if</span> (G != m_Guest)
00385     {
00386       <span class="keywordflow">if</span> (!G) 
00387         <span class="keywordflow">throw</span> PGSTD::logic_error(<span class="stringliteral">"Closing NULL "</span> + <a class="code" href="namespacepqxx.html#a26">Classname</a>(G));
00388       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!m_Guest)
00389         <span class="keywordflow">throw</span> PGSTD::logic_error(<span class="stringliteral">"Closing "</span> + 
00390                                  <a class="code" href="namespacepqxx.html#a26">Classname</a>(G) +
00391                                  <span class="stringliteral">" '"</span> +
00392                                  G-&gt;Name() +
00393                                  <span class="stringliteral">"' which wasn't open"</span>);
00394       <span class="keywordflow">else</span>
00395         <span class="keywordflow">throw</span> PGSTD::logic_error(<span class="stringliteral">"Closing wrong "</span> + 
00396                                  <a class="code" href="namespacepqxx.html#a26">Classname</a>(G) +
00397                                  <span class="stringliteral">"; expected '"</span> +
00398                                  m_Guest-&gt;Name() +
00399                                  <span class="stringliteral">"' but got '"</span> +
00400                                  G-&gt;Name() +
00401                                  <span class="stringliteral">"'"</span>);
00402     }
00403 
00404     m_Guest = 0;
00405   }
00406 
00407 <span class="keyword">private</span>:
00408   GUEST *m_Guest;
00409 
00410   <span class="comment">// Not allowed:</span>
00411   unique(<span class="keyword">const</span> unique &amp;);
00412   unique &amp;operator=(<span class="keyword">const</span> unique &amp;);
00413 };
00414 
00415 }
00416 
00417 <span class="preprocessor">#endif</span>
00418 <span class="preprocessor"></span>
</pre></div><hr><address style="align: right;"><small>Generated on Sat Jun 7 02:58:05 2003 for libpqxx by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
