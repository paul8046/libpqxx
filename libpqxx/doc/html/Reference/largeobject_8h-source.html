<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>largeobject.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>largeobject.h</h1><a href="largeobject_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*-------------------------------------------------------------------------</span>
00002 <span class="comment"> *</span>
00003 <span class="comment"> *   FILE</span>
00004 <span class="comment"> *      pqxx/largeobject.h</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> *   DESCRIPTION</span>
00007 <span class="comment"> *      libpqxx's Large Objects interface</span>
00008 <span class="comment"> *   Allows access to large objects directly, or through I/O streams</span>
00009 <span class="comment"> *</span>
00010 <span class="comment"> * Copyright (c) 2003, Jeroen T. Vermeulen &lt;jtv@xs4all.nl&gt;</span>
00011 <span class="comment"> *</span>
00012 <span class="comment"> *-------------------------------------------------------------------------</span>
00013 <span class="comment"> */</span>
00014 <span class="preprocessor">#ifndef PQXX_LARGEOBJECT_H</span>
00015 <span class="preprocessor"></span><span class="preprocessor">#define PQXX_LARGEOBJECT_H</span>
00016 <span class="preprocessor"></span>
00017 <span class="preprocessor">#include &lt;<a class="code" href="config_8h.html">pqxx/config.h</a>&gt;</span>
00018 
00019 <span class="preprocessor">#ifdef HAVE_STREAMBUF</span>
00020 <span class="preprocessor"></span><span class="preprocessor">#include &lt;streambuf&gt;</span>
00021 <span class="preprocessor">#else</span>
00022 <span class="preprocessor"></span><span class="preprocessor">#include &lt;streambuf.h&gt;</span>
00023 <span class="preprocessor">#endif</span>
00024 <span class="preprocessor"></span>
00025 <span class="preprocessor">#include &lt;<a class="code" href="transaction__base_8h.html">pqxx/transaction_base.h</a>&gt;</span>
00026 
00027 
00028 <span class="keyword">namespace </span>pqxx
00029 {
00030 
00031 <span class="keyword">class </span>LargeObjectAccess;
00032 
00033 
00035 
<a name="l00042"></a><a class="code" href="classpqxx_1_1LargeObject.html">00042</a> <span class="keyword">class </span><a class="code" href="classpqxx_1_1LargeObject.html">LargeObject</a>
00043 {
00044 <span class="keyword">public</span>:
<a name="l00045"></a><a class="code" href="classpqxx_1_1LargeObject.html#s0">00045</a>   <span class="keyword">typedef</span> <span class="keywordtype">long</span> <a class="code" href="classpqxx_1_1LargeObject.html#s0">size_type</a>;
00046 
00048   <a class="code" href="classpqxx_1_1LargeObject.html#a0">LargeObject</a>();                                                        <span class="comment">//[t48]</span>
00049 
00051 
00053   <span class="keyword">explicit</span> <a class="code" href="classpqxx_1_1LargeObject.html#a0">LargeObject</a>(<a class="code" href="classpqxx_1_1Transaction__base.html">Transaction_base</a> &amp;T);                            <span class="comment">//[t48]</span>
00054 
00056 
<a name="l00060"></a><a class="code" href="classpqxx_1_1LargeObject.html#a2">00060</a>   <span class="keyword">explicit</span> <a class="code" href="classpqxx_1_1LargeObject.html#a0">LargeObject</a>(Oid O) : m_ID(O) {}                              <span class="comment">//[t48]</span>
00061 
00063 
00067   <a class="code" href="classpqxx_1_1LargeObject.html#a0">LargeObject</a>(Transaction_base &amp;T, <span class="keyword">const</span> PGSTD::string &amp;File);          <span class="comment">//[t53]</span>
00068 
00070 
00074   <a class="code" href="classpqxx_1_1LargeObject.html#a0">LargeObject</a>(<span class="keyword">const</span> LargeObjectAccess &amp;O);                              <span class="comment">//[t50]</span>
00075 
00077 
<a name="l00080"></a><a class="code" href="classpqxx_1_1LargeObject.html#a5">00080</a>   Oid <a class="code" href="classpqxx_1_1LargeObject.html#a5">id</a>() <span class="keyword">const</span> <span class="keywordflow">throw</span> () { <span class="keywordflow">return</span> m_ID; }                              <span class="comment">//[t48]</span>
00081 
<a name="l00083"></a><a class="code" href="classpqxx_1_1LargeObject.html#a6">00083</a>   <span class="keywordtype">bool</span> <a class="code" href="classpqxx_1_1LargeObject.html#a6">operator==</a>(<span class="keyword">const</span> <a class="code" href="classpqxx_1_1LargeObject.html">LargeObject</a> &amp;other) <span class="keyword">const</span>                       <span class="comment">//[t51]</span>
00084           { <span class="keywordflow">return</span> m_ID == other.m_ID; }
<a name="l00086"></a><a class="code" href="classpqxx_1_1LargeObject.html#a7">00086</a>   <span class="keywordtype">bool</span> <a class="code" href="classpqxx_1_1LargeObject.html#a7">operator!=</a>(<span class="keyword">const</span> <a class="code" href="classpqxx_1_1LargeObject.html">LargeObject</a> &amp;other) <span class="keyword">const</span>                       <span class="comment">//[t51]</span>
00087           { <span class="keywordflow">return</span> m_ID != other.m_ID; }
<a name="l00089"></a><a class="code" href="classpqxx_1_1LargeObject.html#a8">00089</a>   <span class="keywordtype">bool</span> <a class="code" href="classpqxx_1_1LargeObject.html#a8">operator&lt;=</a>(<span class="keyword">const</span> <a class="code" href="classpqxx_1_1LargeObject.html">LargeObject</a> &amp;other) <span class="keyword">const</span>                       <span class="comment">//[t51]</span>
00090           { <span class="keywordflow">return</span> m_ID &lt;= other.m_ID; }
<a name="l00092"></a><a class="code" href="classpqxx_1_1LargeObject.html#a9">00092</a>   <span class="keywordtype">bool</span> <a class="code" href="classpqxx_1_1LargeObject.html#a9">operator&gt;=</a>(<span class="keyword">const</span> <a class="code" href="classpqxx_1_1LargeObject.html">LargeObject</a> &amp;other) <span class="keyword">const</span>                       <span class="comment">//[t51]</span>
00093           { <span class="keywordflow">return</span> m_ID &gt;= other.m_ID; }
<a name="l00095"></a><a class="code" href="classpqxx_1_1LargeObject.html#a10">00095</a>   <span class="keywordtype">bool</span> <a class="code" href="classpqxx_1_1LargeObject.html#a10">operator&lt;</a>(<span class="keyword">const</span> <a class="code" href="classpqxx_1_1LargeObject.html">LargeObject</a> &amp;other) <span class="keyword">const</span>                        <span class="comment">//[t51]</span>
00096           { <span class="keywordflow">return</span> m_ID &lt; other.m_ID; }
<a name="l00098"></a><a class="code" href="classpqxx_1_1LargeObject.html#a11">00098</a>   <span class="keywordtype">bool</span> <a class="code" href="classpqxx_1_1LargeObject.html#a11">operator&gt;</a>(<span class="keyword">const</span> <a class="code" href="classpqxx_1_1LargeObject.html">LargeObject</a> &amp;other) <span class="keyword">const</span>                        <span class="comment">//[t51]</span>
00099           { <span class="keywordflow">return</span> m_ID &gt; other.m_ID; }
00100 
00102 
00106   <span class="keywordtype">void</span> <a class="code" href="classpqxx_1_1LargeObject.html#a12">to_file</a>(Transaction_base &amp;T, <span class="keyword">const</span> PGSTD::string &amp;File) <span class="keyword">const</span>;   <span class="comment">//[t52]</span>
00107 
00109 
00113   <span class="keywordtype">void</span> <a class="code" href="classpqxx_1_1LargeObject.html#a13">remove</a>(Transaction_base &amp;T) <span class="keyword">const</span>;                               <span class="comment">//[t48]</span>
00114 
00115 <span class="keyword">protected</span>:
<a name="l00116"></a><a class="code" href="classpqxx_1_1LargeObject.html#e0">00116</a>   <span class="keyword">static</span> PGconn *<a class="code" href="classpqxx_1_1LargeObject.html#e0">RawConnection</a>(<span class="keyword">const</span> <a class="code" href="classpqxx_1_1Transaction__base.html">Transaction_base</a> &amp;T)
00117   {
00118     <span class="keywordflow">return</span> T.<a class="code" href="classpqxx_1_1Transaction__base.html#a8">Conn</a>().<a class="code" href="classpqxx_1_1Connection__base.html#c18">RawConnection</a>();
00119   }
00120 
00121   PGSTD::string <a class="code" href="classpqxx_1_1LargeObject.html#b0">Reason</a>() <span class="keyword">const</span>;
00122 
00123 <span class="keyword">private</span>:
00124   Oid m_ID;
00125 };
00126 
00127 
<a name="l00129"></a><a class="code" href="classpqxx_1_1LargeObjectAccess.html">00129</a> <span class="keyword">class </span><a class="code" href="classpqxx_1_1LargeObjectAccess.html">LargeObjectAccess</a> : <span class="keyword">private</span> <a class="code" href="classpqxx_1_1LargeObject.html">LargeObject</a>
00130 {
00131 <span class="keyword">public</span>:
00132   <span class="keyword">using</span> LargeObject::size_type;
00133 
00135 
<a name="l00139"></a><a class="code" href="classpqxx_1_1LargeObjectAccess.html#s0">00139</a>   <span class="keyword">typedef</span> PGSTD::ios::openmode <a class="code" href="classpqxx_1_1LargeObjectAccess.html#s0">openmode</a>;
00140 
00142 
<a name="l00146"></a><a class="code" href="classpqxx_1_1LargeObjectAccess.html#s1">00146</a>   <span class="keyword">typedef</span> PGSTD::ios::seekdir <a class="code" href="classpqxx_1_1LargeObjectAccess.html#s1">seekdir</a>;
00147 
00149 
00153   <span class="keyword">explicit</span> <a class="code" href="classpqxx_1_1LargeObjectAccess.html#a0">LargeObjectAccess</a>(<a class="code" href="classpqxx_1_1Transaction__base.html">Transaction_base</a> &amp;T, 
00154                              openmode mode = 
00155                                 PGSTD::ios::in | 
00156                                 PGSTD::ios::out);                       <span class="comment">//[t51]</span>
00157 
00159 
00165   <a class="code" href="classpqxx_1_1LargeObjectAccess.html#a0">LargeObjectAccess</a>(<a class="code" href="classpqxx_1_1Transaction__base.html">Transaction_base</a> &amp;T, 
00166                     Oid O,
00167                     openmode mode = 
00168                         PGSTD::ios::in | 
00169                         PGSTD::ios::out);                               <span class="comment">//[t52]</span>
00170 
00172 
00177   <a class="code" href="classpqxx_1_1LargeObjectAccess.html#a0">LargeObjectAccess</a>(<a class="code" href="classpqxx_1_1Transaction__base.html">Transaction_base</a> &amp;T, 
00178                     <a class="code" href="classpqxx_1_1LargeObject.html">LargeObject</a> O,
00179                     openmode mode = PGSTD::ios::in | PGSTD::ios::out);  <span class="comment">//[t50]</span>
00180 
00182 
00187   <a class="code" href="classpqxx_1_1LargeObjectAccess.html#a0">LargeObjectAccess</a>(<a class="code" href="classpqxx_1_1Transaction__base.html">Transaction_base</a> &amp;T, 
00188                     <span class="keyword">const</span> PGSTD::string &amp;File,
00189                     openmode mode = 
00190                         PGSTD::ios::in | PGSTD::ios::out);              <span class="comment">//[t55]</span>
00191 
<a name="l00192"></a><a class="code" href="classpqxx_1_1LargeObjectAccess.html#a4">00192</a>   <a class="code" href="classpqxx_1_1LargeObjectAccess.html#a4">~LargeObjectAccess</a>() { close(); }
00193 
00195 
00198   <span class="keyword">using</span> LargeObject::id;
00199 
00201 
<a name="l00204"></a><a class="code" href="classpqxx_1_1LargeObjectAccess.html#a5">00204</a>   <span class="keywordtype">void</span> <a class="code" href="classpqxx_1_1LargeObjectAccess.html#a5">to_file</a>(<span class="keyword">const</span> PGSTD::string &amp;File) <span class="keyword">const</span>                         <span class="comment">//[t54]</span>
00205   { 
00206     LargeObject::to_file(m_Trans, File); 
00207   }
00208 
00210 
00214   <span class="keywordtype">void</span> <a class="code" href="classpqxx_1_1LargeObjectAccess.html#a6">write</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> Buf[], size_type Len);                          <span class="comment">//[t51]</span>
00215 
00217 
<a name="l00220"></a><a class="code" href="classpqxx_1_1LargeObjectAccess.html#a7">00220</a>   <span class="keywordtype">void</span> <a class="code" href="classpqxx_1_1LargeObjectAccess.html#a6">write</a>(<span class="keyword">const</span> PGSTD::string &amp;Buf)                                  <span class="comment">//[t50]</span>
00221         { <a class="code" href="classpqxx_1_1LargeObjectAccess.html#a6">write</a>(Buf.c_str(), Buf.size()); }
00222 
00224 
00230   <a class="code" href="classpqxx_1_1LargeObjectAccess.html#s2">size_type</a> <a class="code" href="classpqxx_1_1LargeObjectAccess.html#a8">read</a>(<span class="keywordtype">char</span> Buf[], size_type Len);                            <span class="comment">//[t50]</span>
00231 
00233 
00236   <a class="code" href="classpqxx_1_1LargeObjectAccess.html#s2">size_type</a> <a class="code" href="classpqxx_1_1LargeObjectAccess.html#a9">seek</a>(size_type dest, seekdir dir);                          <span class="comment">//[t51]</span>
00237 
00239 
00247   <span class="keywordtype">long</span> <a class="code" href="classpqxx_1_1LargeObjectAccess.html#a10">cseek</a>(<span class="keywordtype">long</span> dest, seekdir dir) <span class="keywordflow">throw</span> ();                          <span class="comment">//[t50]</span>
00248     
00250 
00256   <span class="keywordtype">long</span> <a class="code" href="classpqxx_1_1LargeObjectAccess.html#a11">cwrite</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> Buf[], size_type Len) <span class="keywordflow">throw</span> ();                <span class="comment">//[t50]</span>
00257 
00259 
00265   <span class="keywordtype">long</span> <a class="code" href="classpqxx_1_1LargeObjectAccess.html#a12">cread</a>(<span class="keywordtype">char</span> Buf[], size_type Len) <span class="keywordflow">throw</span> ();                       <span class="comment">//[t50]</span>
00266 
00267   <span class="keyword">using</span> LargeObject::operator==;
00268   <span class="keyword">using</span> LargeObject::operator!=;
00269   <span class="keyword">using</span> LargeObject::operator&lt;;
00270   <span class="keyword">using</span> LargeObject::operator&lt;=;
00271   <span class="keyword">using</span> LargeObject::operator&gt;;
00272   <span class="keyword">using</span> LargeObject::operator&gt;=;
00273 
00274 <span class="keyword">private</span>:
00275   PGSTD::string <a class="code" href="classpqxx_1_1LargeObject.html#b0">Reason</a>() <span class="keyword">const</span>;
00276   PGconn *<a class="code" href="classpqxx_1_1LargeObject.html#e0">RawConnection</a>() { <span class="keywordflow">return</span> LargeObject::RawConnection(m_Trans); }
00277 
00278   <span class="keywordtype">void</span> open(openmode mode);
00279   <span class="keywordtype">void</span> close();
00280 
00281   Transaction_base &amp;m_Trans;
00282   <span class="keywordtype">int</span> m_fd;
00283 
00284   <span class="comment">// Not allowed:</span>
00285   <a class="code" href="classpqxx_1_1LargeObjectAccess.html#a0">LargeObjectAccess</a>();
00286   <a class="code" href="classpqxx_1_1LargeObjectAccess.html#a0">LargeObjectAccess</a>(<span class="keyword">const</span> LargeObjectAccess &amp;);
00287   <a class="code" href="classpqxx_1_1LargeObjectAccess.html#a0">LargeObjectAccess</a> operator=(<span class="keyword">const</span> LargeObjectAccess &amp;);
00288 };
00289 
00290 
00292 
00297 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> CHAR=<span class="keywordtype">char</span>, <span class="keyword">typename</span> TRAITS=PGSTD::<span class="keywordtype">char</span>_traits&lt;CHAR&gt; &gt;
<a name="l00298"></a><a class="code" href="classpqxx_1_1largeobject__streambuf.html">00298</a>   <span class="keyword">class </span><a class="code" href="classpqxx_1_1largeobject__streambuf.html">largeobject_streambuf</a> :
00299 #ifdef <a class="code" href="config_8h.html#a12">HAVE_STREAMBUF</a>
00300     <span class="keyword">public</span> <a class="code" href="config_8h.html#a25">PGSTD</a>::basic_streambuf&lt;CHAR, TRAITS&gt;
00301 #else
00302     <span class="keyword">public</span> <a class="code" href="config_8h.html#a25">PGSTD</a>::streambuf
00303 #endif
00304 {
00305   <span class="keyword">typedef</span> <span class="keywordtype">long</span> size_type;
00306 <span class="keyword">public</span>:
<a name="l00307"></a><a class="code" href="classpqxx_1_1largeobject__streambuf.html#s0">00307</a>   <span class="keyword">typedef</span> CHAR   <a class="code" href="classpqxx_1_1largeobject__streambuf.html#s0">char_type</a>;
<a name="l00308"></a><a class="code" href="classpqxx_1_1largeobject__streambuf.html#s1">00308</a>   <span class="keyword">typedef</span> TRAITS <a class="code" href="classpqxx_1_1largeobject__streambuf.html#s1">traits_type</a>;
<a name="l00309"></a><a class="code" href="classpqxx_1_1largeobject__streambuf.html#s2">00309</a>   <span class="keyword">typedef</span> <span class="keyword">typename</span> traits_type::int_type <a class="code" href="classpqxx_1_1largeobject__streambuf.html#s2">int_type</a>;
<a name="l00310"></a><a class="code" href="classpqxx_1_1largeobject__streambuf.html#s3">00310</a>   <span class="keyword">typedef</span> <span class="keyword">typename</span> traits_type::pos_type <a class="code" href="classpqxx_1_1largeobject__streambuf.html#s3">pos_type</a>;
<a name="l00311"></a><a class="code" href="classpqxx_1_1largeobject__streambuf.html#s4">00311</a>   <span class="keyword">typedef</span> <span class="keyword">typename</span> traits_type::off_type <a class="code" href="classpqxx_1_1largeobject__streambuf.html#s4">off_type</a>;
<a name="l00312"></a><a class="code" href="classpqxx_1_1largeobject__streambuf.html#s5">00312</a>   <span class="keyword">typedef</span> LargeObjectAccess::openmode <a class="code" href="classpqxx_1_1largeobject__streambuf.html#s5">openmode</a>;
<a name="l00313"></a><a class="code" href="classpqxx_1_1largeobject__streambuf.html#s6">00313</a>   <span class="keyword">typedef</span> LargeObjectAccess::seekdir <a class="code" href="classpqxx_1_1largeobject__streambuf.html#s6">seekdir</a>;
00314 
<a name="l00315"></a><a class="code" href="classpqxx_1_1largeobject__streambuf.html#a0">00315</a>   <a class="code" href="classpqxx_1_1largeobject__streambuf.html#a0">largeobject_streambuf</a>(<a class="code" href="classpqxx_1_1Transaction__base.html">Transaction_base</a> &amp;T,
00316                         <a class="code" href="classpqxx_1_1LargeObject.html">LargeObject</a> O,
00317                         openmode mode = in | out,
00318                         size_type BufSize=512) :                        <span class="comment">//[t48]</span>
00319     m_BufSize(BufSize),
00320     m_Obj(T, O),
00321     m_G(0),
00322     m_P(0)
00323   {
00324     initialize(mode);
00325   }
00326 
<a name="l00327"></a><a class="code" href="classpqxx_1_1largeobject__streambuf.html#a1">00327</a>   <a class="code" href="classpqxx_1_1largeobject__streambuf.html#a0">largeobject_streambuf</a>(<a class="code" href="classpqxx_1_1Transaction__base.html">Transaction_base</a> &amp;T,
00328                         Oid O,
00329                         openmode mode = in | out,
00330                         size_type BufSize=512) :                        <span class="comment">//[t48]</span>
00331     m_BufSize(BufSize),
00332     m_Obj(T, O),
00333     m_G(0),
00334     m_P(0)
00335   {
00336     initialize(mode);
00337   }
00338 
<a name="l00339"></a><a class="code" href="classpqxx_1_1largeobject__streambuf.html#a2">00339</a>   <span class="keyword">virtual</span> <a class="code" href="classpqxx_1_1largeobject__streambuf.html#a2">~largeobject_streambuf</a>()
00340   {
00341     <span class="keyword">delete</span> [] m_P;
00342     <span class="keyword">delete</span> [] m_G;
00343   }
00344 
00345 
00346 <span class="preprocessor">#ifdef HAVE_STREAMBUF</span>
00347 <span class="preprocessor"></span><span class="keyword">protected</span>:
00348 <span class="preprocessor">#endif</span>
<a name="l00349"></a><a class="code" href="classpqxx_1_1largeobject__streambuf.html#a3">00349</a> <span class="preprocessor"></span>  <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="classpqxx_1_1largeobject__streambuf.html#a3">sync</a>()
00350   {
00351     <span class="comment">// setg() sets eback, gptr, egptr</span>
00352     setg(eback(), eback(), egptr());
00353     <span class="keywordflow">return</span> <a class="code" href="classpqxx_1_1largeobject__streambuf.html#b2">overflow</a>(EoF());
00354   }
00355 
00356 <span class="keyword">protected</span>:
<a name="l00357"></a><a class="code" href="classpqxx_1_1largeobject__streambuf.html#b0">00357</a>   <span class="keyword">virtual</span> pos_type <a class="code" href="classpqxx_1_1largeobject__streambuf.html#b0">seekoff</a>(off_type offset, 
00358                            seekdir dir,
00359                            openmode mode = in|out)
00360   {
00361     <span class="keywordflow">if</span> (!mode) {}       <span class="comment">// Quench "unused parameter" warning</span>
00362     <span class="keywordflow">return</span> AdjustEOF(m_Obj.<a class="code" href="classpqxx_1_1LargeObjectAccess.html#a10">cseek</a>(offset, dir));
00363   }
00364 
<a name="l00365"></a><a class="code" href="classpqxx_1_1largeobject__streambuf.html#b1">00365</a>   <span class="keyword">virtual</span> pos_type <a class="code" href="classpqxx_1_1largeobject__streambuf.html#b1">seekpos</a>(pos_type pos, 
00366                            openmode mode = in|out)
00367   {
00368     <span class="keywordflow">if</span> (!mode) {}       <span class="comment">// Quench "unused parameter" warning</span>
00369     <span class="keywordflow">return</span> AdjustEOF(m_Obj.<a class="code" href="classpqxx_1_1LargeObjectAccess.html#a10">cseek</a>(pos, PGSTD::ios::beg));
00370   }
00371 
<a name="l00372"></a><a class="code" href="classpqxx_1_1largeobject__streambuf.html#b2">00372</a>   <span class="keyword">virtual</span> int_type <a class="code" href="classpqxx_1_1largeobject__streambuf.html#b2">overflow</a>(int_type ch = EoF())
00373   {
00374     <span class="keywordtype">char</span> *<span class="keyword">const</span> pp = pptr();
00375     <span class="keywordflow">if</span> (!pp) <span class="keywordflow">return</span> EoF();
00376     <span class="keywordtype">char</span> *<span class="keyword">const</span> pb = pbase();
00377     int_type result = 0;
00378 
00379     <span class="keywordflow">if</span> (pp &gt; pb) result = AdjustEOF(m_Obj.<a class="code" href="classpqxx_1_1LargeObjectAccess.html#a11">cwrite</a>(pb, pp-pb));
00380     setp(m_P, m_P + m_BufSize);
00381 
00382     <span class="comment">// Write that one more character, if it's there.</span>
00383     <span class="keywordflow">if</span> (ch != EoF())
00384     {
00385       *pptr() = char(ch);
00386       pbump(1);
00387     }
00388     <span class="keywordflow">return</span> result;
00389   }
00390 
<a name="l00391"></a><a class="code" href="classpqxx_1_1largeobject__streambuf.html#b3">00391</a>   <span class="keyword">virtual</span> int_type <a class="code" href="classpqxx_1_1largeobject__streambuf.html#b3">underflow</a>()
00392   {
00393     <span class="keywordflow">if</span> (!gptr()) <span class="keywordflow">return</span> EoF();
00394     <span class="keywordtype">char</span> *<span class="keyword">const</span> eb = eback();
00395     <span class="keyword">const</span> <span class="keywordtype">int</span> result = AdjustEOF(m_Obj.<a class="code" href="classpqxx_1_1LargeObjectAccess.html#a12">cread</a>(eback(), m_BufSize));
00396     setg(eb, eb, eb + ((result==EoF()) ? 0 : result));
00397     <span class="keywordflow">return</span> (!result || (result == EoF())) ? EoF() : *eb;
00398   }
00399 
00400 <span class="keyword">private</span>:
00402   <span class="keyword">static</span> int_type EoF() { <span class="keywordflow">return</span> traits_type::eof(); }
00403 
00405   <span class="keyword">static</span> PGSTD::streampos AdjustEOF(<span class="keywordtype">int</span> pos)
00406   {
00407     <span class="keywordflow">return</span> (pos == -1) ? EoF() : pos;
00408   }
00409 
00410   <span class="keywordtype">void</span> initialize(openmode mode)
00411   {
00412     <span class="keywordflow">if</span> (mode &amp; PGSTD::ios::in) 
00413     {
00414       m_G = <span class="keyword">new</span> char_type[m_BufSize];
00415       setg(m_G, m_G, m_G);
00416     }
00417     <span class="keywordflow">if</span> (mode &amp; PGSTD::ios::out)
00418     {
00419       m_P = <span class="keyword">new</span> char_type[m_BufSize];
00420       setp(m_P, m_P + m_BufSize);
00421     }
00422   }
00423 
00424   <span class="keyword">const</span> size_type m_BufSize;
00425   LargeObjectAccess m_Obj;
00426 
00427   <span class="comment">// Get &amp; put buffers</span>
00428   char_type *m_G, *m_P;
00429 };
00430 
00431 
00433 
00440 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> CHAR=<span class="keywordtype">char</span>, <span class="keyword">typename</span> TRAITS=PGSTD::<span class="keywordtype">char</span>_traits&lt;CHAR&gt; &gt; 
<a name="l00441"></a><a class="code" href="classpqxx_1_1basic__ilostream.html">00441</a>   <span class="keyword">class </span><a class="code" href="classpqxx_1_1basic__ilostream.html">basic_ilostream</a> :
00442 #ifdef <a class="code" href="config_8h.html#a12">HAVE_STREAMBUF</a>
00443     <span class="keyword">public</span> <a class="code" href="config_8h.html#a25">PGSTD</a>::basic_istream&lt;CHAR, TRAITS&gt;
00444 #else
00445     <span class="keyword">public</span> <a class="code" href="config_8h.html#a25">PGSTD</a>::istream
00446 #endif
00447 {
00448 <span class="preprocessor">#ifdef HAVE_STREAMBUF</span>
00449 <span class="preprocessor"></span>  <span class="keyword">typedef</span> PGSTD::basic_istream&lt;CHAR, TRAITS&gt; super;
00450 <span class="preprocessor">#else</span>
00451 <span class="preprocessor"></span>  <span class="keyword">typedef</span> PGSTD::istream super;
00452 <span class="preprocessor">#endif</span>
00453 <span class="preprocessor"></span>
00454 <span class="keyword">public</span>:
<a name="l00455"></a><a class="code" href="classpqxx_1_1basic__ilostream.html#s0">00455</a>   <span class="keyword">typedef</span> CHAR char_type;
<a name="l00456"></a><a class="code" href="classpqxx_1_1basic__ilostream.html#s1">00456</a>   <span class="keyword">typedef</span> TRAITS traits_type;
<a name="l00457"></a><a class="code" href="classpqxx_1_1basic__ilostream.html#s2">00457</a>   <span class="keyword">typedef</span> <span class="keyword">typename</span> traits_type::int_type int_type;
<a name="l00458"></a><a class="code" href="classpqxx_1_1basic__ilostream.html#s3">00458</a>   <span class="keyword">typedef</span> <span class="keyword">typename</span> traits_type::pos_type pos_type;
<a name="l00459"></a><a class="code" href="classpqxx_1_1basic__ilostream.html#s4">00459</a>   <span class="keyword">typedef</span> <span class="keyword">typename</span> traits_type::off_type off_type;
00460 
00462 
<a name="l00466"></a><a class="code" href="classpqxx_1_1basic__ilostream.html#a0">00466</a>   <a class="code" href="classpqxx_1_1basic__ilostream.html#a0">basic_ilostream</a>(<a class="code" href="classpqxx_1_1Transaction__base.html">Transaction_base</a> &amp;T, 
00467                   <a class="code" href="classpqxx_1_1LargeObject.html">LargeObject</a> O, 
00468                   LargeObject::size_type BufSize=512) :                 <span class="comment">//[]</span>
00469     super(m_Buf),
00470     m_Buf(T, O, in, BufSize) 
00471   { 
00472   }
00473 
00475 
<a name="l00479"></a><a class="code" href="classpqxx_1_1basic__ilostream.html#a1">00479</a>   <a class="code" href="classpqxx_1_1basic__ilostream.html#a0">basic_ilostream</a>(<a class="code" href="classpqxx_1_1Transaction__base.html">Transaction_base</a> &amp;T, 
00480                   Oid O, 
00481                   LargeObject::size_type BufSize=512) :                 <span class="comment">//[t48]</span>
00482     super(&amp;m_Buf),
00483     m_Buf(T, O, in, BufSize) 
00484   { 
00485   }
00486 
00487 <span class="keyword">private</span>:
00488   largeobject_streambuf&lt;CHAR,TRAITS&gt; m_Buf;
00489 };
00490 
<a name="l00491"></a><a class="code" href="namespacepqxx.html#a1">00491</a> <span class="keyword">typedef</span> <a class="code" href="classpqxx_1_1basic__ilostream.html">basic_ilostream&lt;char&gt;</a> <a class="code" href="namespacepqxx.html#a1">ilostream</a>;
00492 
00493 
00495 
00502 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> CHAR=<span class="keywordtype">char</span>, <span class="keyword">typename</span> TRAITS=PGSTD::<span class="keywordtype">char</span>_traits&lt;CHAR&gt; &gt; 
<a name="l00503"></a><a class="code" href="classpqxx_1_1basic__olostream.html">00503</a>   <span class="keyword">class </span><a class="code" href="classpqxx_1_1basic__olostream.html">basic_olostream</a> : 
00504 #ifdef <a class="code" href="config_8h.html#a12">HAVE_STREAMBUF</a>
00505     <span class="keyword">public</span> <a class="code" href="config_8h.html#a25">PGSTD</a>::basic_ostream&lt;CHAR, TRAITS&gt;
00506 #else
00507     <span class="keyword">public</span> <a class="code" href="config_8h.html#a25">PGSTD</a>::ostream
00508 #endif
00509 {
00510 <span class="preprocessor">#ifdef HAVE_STREAMBUF</span>
00511 <span class="preprocessor"></span>  <span class="keyword">typedef</span> PGSTD::basic_ostream&lt;CHAR, TRAITS&gt; super;
00512 <span class="preprocessor">#else</span>
00513 <span class="preprocessor"></span>  <span class="keyword">typedef</span> PGSTD::ostream super;
00514 <span class="preprocessor">#endif</span>
00515 <span class="preprocessor"></span><span class="keyword">public</span>:
<a name="l00516"></a><a class="code" href="classpqxx_1_1basic__olostream.html#s0">00516</a>   <span class="keyword">typedef</span> CHAR char_type;
<a name="l00517"></a><a class="code" href="classpqxx_1_1basic__olostream.html#s1">00517</a>   <span class="keyword">typedef</span> TRAITS traits_type;
<a name="l00518"></a><a class="code" href="classpqxx_1_1basic__olostream.html#s2">00518</a>   <span class="keyword">typedef</span> <span class="keyword">typename</span> traits_type::int_type int_type;
<a name="l00519"></a><a class="code" href="classpqxx_1_1basic__olostream.html#s3">00519</a>   <span class="keyword">typedef</span> <span class="keyword">typename</span> traits_type::pos_type pos_type;
<a name="l00520"></a><a class="code" href="classpqxx_1_1basic__olostream.html#s4">00520</a>   <span class="keyword">typedef</span> <span class="keyword">typename</span> traits_type::off_type off_type;
00521 
00523 
<a name="l00527"></a><a class="code" href="classpqxx_1_1basic__olostream.html#a0">00527</a>   <a class="code" href="classpqxx_1_1basic__olostream.html#a0">basic_olostream</a>(<a class="code" href="classpqxx_1_1Transaction__base.html">Transaction_base</a> &amp;T, 
00528                   <a class="code" href="classpqxx_1_1LargeObject.html">LargeObject</a> O,
00529                   LargeObject::size_type BufSize=512) :                 <span class="comment">//[t48]</span>
00530     super(&amp;m_Buf),
00531     m_Buf(T, O, out, BufSize) 
00532   { 
00533   }
00534 
00536 
<a name="l00540"></a><a class="code" href="classpqxx_1_1basic__olostream.html#a1">00540</a>   <a class="code" href="classpqxx_1_1basic__olostream.html#a0">basic_olostream</a>(<a class="code" href="classpqxx_1_1Transaction__base.html">Transaction_base</a> &amp;T, 
00541                   Oid O,
00542                   LargeObject::size_type BufSize=512) :                 <span class="comment">//[]</span>
00543     super(&amp;m_Buf),
00544     m_Buf(T, O, out, BufSize) 
00545   { 
00546   }
00547 
<a name="l00548"></a><a class="code" href="classpqxx_1_1basic__olostream.html#a2">00548</a>   <a class="code" href="classpqxx_1_1basic__olostream.html#a2">~basic_olostream</a>() 
00549   { 
00550 <span class="preprocessor">#ifdef HAVE_STREAMBUF</span>
00551 <span class="preprocessor"></span>    m_Buf.pubsync(); m_Buf.pubsync(); 
00552 <span class="preprocessor">#else</span>
00553 <span class="preprocessor"></span>    m_Buf.sync(); m_Buf.sync();
00554 <span class="preprocessor">#endif</span>
00555 <span class="preprocessor"></span>  }
00556 
00557 <span class="keyword">private</span>:
00558   largeobject_streambuf&lt;CHAR,TRAITS&gt; m_Buf;
00559 };
00560 
<a name="l00561"></a><a class="code" href="namespacepqxx.html#a2">00561</a> <span class="keyword">typedef</span> <a class="code" href="classpqxx_1_1basic__olostream.html">basic_olostream&lt;char&gt;</a> <a class="code" href="namespacepqxx.html#a2">olostream</a>;
00562 
00563 
00565 
00572 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> CHAR=<span class="keywordtype">char</span>, <span class="keyword">typename</span> TRAITS=PGSTD::<span class="keywordtype">char</span>_traits&lt;CHAR&gt; &gt; 
<a name="l00573"></a><a class="code" href="classpqxx_1_1basic__lostream.html">00573</a>   <span class="keyword">class </span><a class="code" href="classpqxx_1_1basic__lostream.html">basic_lostream</a> :
00574 #ifdef <a class="code" href="config_8h.html#a12">HAVE_STREAMBUF</a>
00575     <span class="keyword">public</span> <a class="code" href="config_8h.html#a25">PGSTD</a>::basic_iostream&lt;CHAR, TRAITS&gt;
00576 #else
00577     <span class="keyword">public</span> <a class="code" href="config_8h.html#a25">PGSTD</a>::iostream
00578 #endif
00579 {
00580 <span class="preprocessor">#ifdef HAVE_STREAMBUF</span>
00581 <span class="preprocessor"></span>  <span class="keyword">typedef</span> PGSTD::basic_iostream&lt;CHAR, TRAITS&gt; super;
00582 <span class="preprocessor">#else</span>
00583 <span class="preprocessor"></span>  <span class="keyword">typedef</span> PGSTD::iostream super;
00584 <span class="preprocessor">#endif</span>
00585 <span class="preprocessor"></span>
00586 <span class="keyword">public</span>:
<a name="l00587"></a><a class="code" href="classpqxx_1_1basic__lostream.html#s0">00587</a>   <span class="keyword">typedef</span> CHAR char_type;
<a name="l00588"></a><a class="code" href="classpqxx_1_1basic__lostream.html#s1">00588</a>   <span class="keyword">typedef</span> TRAITS traits_type;
<a name="l00589"></a><a class="code" href="classpqxx_1_1basic__lostream.html#s2">00589</a>   <span class="keyword">typedef</span> <span class="keyword">typename</span> traits_type::int_type int_type;
<a name="l00590"></a><a class="code" href="classpqxx_1_1basic__lostream.html#s3">00590</a>   <span class="keyword">typedef</span> <span class="keyword">typename</span> traits_type::pos_type pos_type;
<a name="l00591"></a><a class="code" href="classpqxx_1_1basic__lostream.html#s4">00591</a>   <span class="keyword">typedef</span> <span class="keyword">typename</span> traits_type::off_type off_type;
00592 
00594 
<a name="l00598"></a><a class="code" href="classpqxx_1_1basic__lostream.html#a0">00598</a>   <a class="code" href="classpqxx_1_1basic__lostream.html#a0">basic_lostream</a>(<a class="code" href="classpqxx_1_1Transaction__base.html">Transaction_base</a> &amp;T, 
00599                  <a class="code" href="classpqxx_1_1LargeObject.html">LargeObject</a> O,
00600                  LargeObject::size_type BufSize=512) :                  <span class="comment">//[]</span>
00601     super(&amp;m_Buf),
00602     m_Buf(T, O, in | out, BufSize) 
00603   { 
00604   }
00605 
00607 
<a name="l00611"></a><a class="code" href="classpqxx_1_1basic__lostream.html#a1">00611</a>   <a class="code" href="classpqxx_1_1basic__lostream.html#a0">basic_lostream</a>(<a class="code" href="classpqxx_1_1Transaction__base.html">Transaction_base</a> &amp;T, 
00612                  Oid O,
00613                  LargeObject::size_type BufSize=512) :                  <span class="comment">//[]</span>
00614     super(&amp;m_Buf),
00615     m_Buf(T, O, in | out, BufSize) 
00616   { 
00617   }
00618 
<a name="l00619"></a><a class="code" href="classpqxx_1_1basic__lostream.html#a2">00619</a>   <a class="code" href="classpqxx_1_1basic__lostream.html#a2">~basic_lostream</a>() 
00620   { 
00621 <span class="preprocessor">#ifdef HAVE_STREAMBUF</span>
00622 <span class="preprocessor"></span>    m_Buf.pubsync(); m_Buf.pubsync(); 
00623 <span class="preprocessor">#else</span>
00624 <span class="preprocessor"></span>    m_Buf.sync(); m_Buf.sync();
00625 <span class="preprocessor">#endif</span>
00626 <span class="preprocessor"></span>  }
00627 
00628 <span class="keyword">private</span>:
00629   largeobject_streambuf&lt;CHAR,TRAITS&gt; m_Buf;
00630 };
00631 
<a name="l00632"></a><a class="code" href="namespacepqxx.html#a3">00632</a> <span class="keyword">typedef</span> <a class="code" href="classpqxx_1_1basic__lostream.html">basic_lostream&lt;char&gt;</a> <a class="code" href="namespacepqxx.html#a3">lostream</a>;
00633 
00634 }
00635 
00636 <span class="preprocessor">#endif</span>
00637 <span class="preprocessor"></span>
</pre></div><hr><address style="align: right;"><small>Generated on Sat May 10 18:46:39 2003 for libpqxx by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
