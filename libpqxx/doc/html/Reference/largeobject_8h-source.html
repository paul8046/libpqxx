<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>largeobject.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>largeobject.h</h1><a href="largeobject_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*-------------------------------------------------------------------------</span>
00002 <span class="comment"> *</span>
00003 <span class="comment"> *   FILE</span>
00004 <span class="comment"> *      pqxx/largeobject.h</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> *   DESCRIPTION</span>
00007 <span class="comment"> *      libpqxx's Large Objects interface</span>
00008 <span class="comment"> *   Allows access to large objects directly, or through I/O streams</span>
00009 <span class="comment"> *</span>
00010 <span class="comment"> * Copyright (c) 2003, Jeroen T. Vermeulen &lt;jtv@xs4all.nl&gt;</span>
00011 <span class="comment"> *</span>
00012 <span class="comment"> *-------------------------------------------------------------------------</span>
00013 <span class="comment"> */</span>
00014 <span class="preprocessor">#ifndef PQXX_LARGEOBJECT_H</span>
00015 <span class="preprocessor"></span><span class="preprocessor">#define PQXX_LARGEOBJECT_H</span>
00016 <span class="preprocessor"></span>
00017 <span class="preprocessor">#include &lt;streambuf&gt;</span>
00018 
00019 <span class="preprocessor">#include &lt;<a class="code" href="transactionitf_8h.html">pqxx/transactionitf.h</a>&gt;</span>
00020 
00021 
00022 <span class="keyword">namespace </span>pqxx
00023 {
00024 
00025 <span class="keyword">class </span>LargeObjectAccess;
00026 
00027 
00029 
<a name="l00036"></a><a class="code" href="classpqxx_1_1LargeObject.html">00036</a> <span class="keyword">class </span><a class="code" href="classpqxx_1_1LargeObject.html">LargeObject</a>
00037 {
00038 <span class="keyword">public</span>:
<a name="l00040"></a><a class="code" href="classpqxx_1_1LargeObject.html#a0">00040</a>   <a class="code" href="classpqxx_1_1LargeObject.html#a0">LargeObject</a>() : m_ID(InvalidOid) {}                                   <span class="comment">//[t48]</span>
00041 
00043 
00045   <span class="keyword">explicit</span> <a class="code" href="classpqxx_1_1LargeObject.html#a0">LargeObject</a>(TransactionItf &amp;T);                              <span class="comment">//[t48]</span>
00046 
00048 
<a name="l00052"></a><a class="code" href="classpqxx_1_1LargeObject.html#a2">00052</a>   <span class="keyword">explicit</span> <a class="code" href="classpqxx_1_1LargeObject.html#a0">LargeObject</a>(Oid O) : m_ID(O) {}                              <span class="comment">//[t48]</span>
00053 
00055 
00059   <a class="code" href="classpqxx_1_1LargeObject.html#a0">LargeObject</a>(TransactionItf &amp;T, <span class="keyword">const</span> PGSTD::string &amp;File);            <span class="comment">//[]</span>
00060 
00062 
00066   <a class="code" href="classpqxx_1_1LargeObject.html#a0">LargeObject</a>(<span class="keyword">const</span> LargeObjectAccess &amp;O);                              <span class="comment">//[]</span>
00067 
00069 
<a name="l00072"></a><a class="code" href="classpqxx_1_1LargeObject.html#a5">00072</a>   Oid <a class="code" href="classpqxx_1_1LargeObject.html#a5">id</a>() <span class="keyword">const</span> <span class="keywordflow">throw</span> () { <span class="keywordflow">return</span> m_ID; }                              <span class="comment">//[t48]</span>
00073 
<a name="l00075"></a><a class="code" href="classpqxx_1_1LargeObject.html#a6">00075</a>   <span class="keywordtype">bool</span> <a class="code" href="classpqxx_1_1LargeObject.html#a6">operator==</a>(<span class="keyword">const</span> <a class="code" href="classpqxx_1_1LargeObject.html">LargeObject</a> &amp;other) <span class="keyword">const</span>                       <span class="comment">//[]</span>
00076         { <span class="keywordflow">return</span> m_ID == other.m_ID; }
<a name="l00078"></a><a class="code" href="classpqxx_1_1LargeObject.html#a7">00078</a>   <span class="keywordtype">bool</span> <a class="code" href="classpqxx_1_1LargeObject.html#a7">operator!=</a>(<span class="keyword">const</span> <a class="code" href="classpqxx_1_1LargeObject.html">LargeObject</a> &amp;other) <span class="keyword">const</span>                       <span class="comment">//[]</span>
00079         { <span class="keywordflow">return</span> m_ID != other.m_ID; }
<a name="l00081"></a><a class="code" href="classpqxx_1_1LargeObject.html#a8">00081</a>   <span class="keywordtype">bool</span> <a class="code" href="classpqxx_1_1LargeObject.html#a8">operator&lt;=</a>(<span class="keyword">const</span> <a class="code" href="classpqxx_1_1LargeObject.html">LargeObject</a> &amp;other) <span class="keyword">const</span>                       <span class="comment">//[]</span>
00082         { <span class="keywordflow">return</span> m_ID &lt;= other.m_ID; }
<a name="l00084"></a><a class="code" href="classpqxx_1_1LargeObject.html#a9">00084</a>   <span class="keywordtype">bool</span> <a class="code" href="classpqxx_1_1LargeObject.html#a9">operator&gt;=</a>(<span class="keyword">const</span> <a class="code" href="classpqxx_1_1LargeObject.html">LargeObject</a> &amp;other) <span class="keyword">const</span>                       <span class="comment">//[]</span>
00085         { <span class="keywordflow">return</span> m_ID &gt;= other.m_ID; }
<a name="l00087"></a><a class="code" href="classpqxx_1_1LargeObject.html#a10">00087</a>   <span class="keywordtype">bool</span> <a class="code" href="classpqxx_1_1LargeObject.html#a10">operator&lt;</a>(<span class="keyword">const</span> <a class="code" href="classpqxx_1_1LargeObject.html">LargeObject</a> &amp;other) <span class="keyword">const</span>                        <span class="comment">//[]</span>
00088         { <span class="keywordflow">return</span> m_ID &lt; other.m_ID; }
<a name="l00090"></a><a class="code" href="classpqxx_1_1LargeObject.html#a11">00090</a>   <span class="keywordtype">bool</span> <a class="code" href="classpqxx_1_1LargeObject.html#a11">operator&gt;</a>(<span class="keyword">const</span> <a class="code" href="classpqxx_1_1LargeObject.html">LargeObject</a> &amp;other) <span class="keyword">const</span>                        <span class="comment">//[]</span>
00091         { <span class="keywordflow">return</span> m_ID &gt; other.m_ID; }
00092 
00094 
00098   <span class="keywordtype">void</span> <a class="code" href="classpqxx_1_1LargeObject.html#a12">to_file</a>(TransactionItf &amp;T, <span class="keyword">const</span> <span class="keywordtype">char</span> File[]) <span class="keyword">const</span>;             <span class="comment">//[]</span>
00099 
00101 
<a name="l00105"></a><a class="code" href="classpqxx_1_1LargeObject.html#a13">00105</a>   <span class="keywordtype">void</span> <a class="code" href="classpqxx_1_1LargeObject.html#a12">to_file</a>(<a class="code" href="classpqxx_1_1TransactionItf.html">TransactionItf</a> &amp;T, <span class="keyword">const</span> PGSTD::string &amp;File) <span class="keyword">const</span>      <span class="comment">//[]</span>
00106   { 
00107     <a class="code" href="classpqxx_1_1LargeObject.html#a12">to_file</a>(T, File.c_str()); 
00108   }
00109 
00111 
00115   <span class="keywordtype">void</span> <a class="code" href="classpqxx_1_1LargeObject.html#a14">remove</a>(TransactionItf &amp;T) <span class="keyword">const</span>;                                 <span class="comment">//[t48]</span>
00116 
00117 <span class="keyword">protected</span>:
<a name="l00118"></a><a class="code" href="classpqxx_1_1LargeObject.html#e0">00118</a>   <span class="keyword">static</span> PGconn *<a class="code" href="classpqxx_1_1LargeObject.html#e0">RawConnection</a>(<span class="keyword">const</span> <a class="code" href="classpqxx_1_1TransactionItf.html">TransactionItf</a> &amp;T)
00119   {
00120     <span class="keywordflow">return</span> T.<a class="code" href="classpqxx_1_1TransactionItf.html#a8">Conn</a>().<a class="code" href="classpqxx_1_1Connection.html#c15">RawConnection</a>();
00121   }
00122 
00123 <span class="keyword">private</span>:
00124   Oid m_ID;
00125 };
00126 
00127 
00128 <span class="comment">// TODO: Consider iLargeObjectAccess, oLargeObjectAccess!?</span>
<a name="l00130"></a><a class="code" href="classpqxx_1_1LargeObjectAccess.html">00130</a> <span class="comment">class LargeObjectAccess : private LargeObject</span>
00131 {
00132 <span class="keyword">public</span>:
00134 
00138   <span class="keyword">explicit</span> <a class="code" href="classpqxx_1_1LargeObjectAccess.html">LargeObjectAccess</a>(<a class="code" href="classpqxx_1_1TransactionItf.html">TransactionItf</a> &amp;T, 
00139                              PGSTD::ios_base::openmode mode = 
00140                                 PGSTD::ios_base::in | 
00141                                 PGSTD::ios_base::out);                  <span class="comment">//[]</span>
00142 
00144 
00150   <span class="keyword">explicit</span> <a class="code" href="classpqxx_1_1LargeObjectAccess.html">LargeObjectAccess</a>(<a class="code" href="classpqxx_1_1TransactionItf.html">TransactionItf</a> &amp;T, 
00151                              Oid O,
00152                              PGSTD::ios_base::openmode mode = 
00153                                 PGSTD::ios_base::in | 
00154                                 PGSTD::ios_base::out);                  <span class="comment">//[]</span>
00155 
00157 
00162   <span class="keyword">explicit</span> <a class="code" href="classpqxx_1_1LargeObjectAccess.html">LargeObjectAccess</a>(<a class="code" href="classpqxx_1_1TransactionItf.html">TransactionItf</a> &amp;T, 
00163                              <a class="code" href="classpqxx_1_1LargeObject.html">LargeObject</a> O,
00164                              PGSTD::ios_base::openmode mode = 
00165                                 PGSTD::ios_base::in | 
00166                                 PGSTD::ios_base::out);                  <span class="comment">//[]</span>
00167 
00169 
00174   <a class="code" href="classpqxx_1_1LargeObjectAccess.html">LargeObjectAccess</a>(<a class="code" href="classpqxx_1_1TransactionItf.html">TransactionItf</a> &amp;T, 
00175                     <span class="keyword">const</span> PGSTD::string &amp;File,
00176                     PGSTD::ios_base::openmode mode = 
00177                         PGSTD::ios_base::in | PGSTD::ios_base::out);    <span class="comment">//[]</span>
00178 
<a name="l00179"></a><a class="code" href="classpqxx_1_1LargeObjectAccess.html#a4">00179</a>   ~<a class="code" href="classpqxx_1_1LargeObjectAccess.html">LargeObjectAccess</a>() { close(); }
00180 
00182 
00185   <span class="keyword">using</span> LargeObject::id;
00186 
00188 
<a name="l00191"></a><a class="code" href="classpqxx_1_1LargeObjectAccess.html#a5">00191</a>   <span class="keywordtype">void</span> to_file(<span class="keyword">const</span> <span class="keywordtype">char</span> File[])<span class="keyword"> const </span>
00192 <span class="keyword">  </span>{ 
00193     LargeObject::to_file(m_Trans, File); 
00194   }
00195 
00197 
<a name="l00200"></a><a class="code" href="classpqxx_1_1LargeObjectAccess.html#a6">00200</a>   <span class="keywordtype">void</span> to_file(<span class="keyword">const</span> PGSTD::string &amp;File)<span class="keyword"> const </span>
00201 <span class="keyword">  </span>{ 
00202     LargeObject::to_file(m_Trans, File); 
00203   }
00204 
00205   <span class="comment">// TODO: Document return value</span>
00207 <span class="comment">  /** Does not throw exception in case of error; inspect return value instead.</span>
00208    * @param dest offset to go to
00209    * @param dir origin to which dest is relative: ios_base::beg (from beginning 
00210    *        of the object), ios_base::cur (from current access position), or
00211    *        ios_base;:end (from end of object)
00212    */
00213   <span class="keywordtype">long</span> cseek(<span class="keywordtype">long</span> dest, PGSTD::ios_base::seekdir dir) <span class="keywordflow">throw</span> ();
00214   
00215   <span class="comment">// TODO: Document return value</span>
00217 <span class="comment">  /** Does not throw exception in case of error; inspect return value instead.</span>
00218    * @param Buf bytes to write
00219    * @param Len number of bytes to write
00220    */
00221   <span class="keywordtype">long</span> cwrite(<span class="keyword">const</span> <span class="keywordtype">char</span> Buf[], size_t Len) <span class="keywordflow">throw</span> ();
00222 
00223   <span class="comment">// TODO: Document return value</span>
00225 <span class="comment">  /** Does not throw exception in case of error; inspect return value instead.</span>
00226    * @param Buf area where bytes should be stored
00227    * @param Len number of bytes to read
00228    */
00229   <span class="keywordtype">long</span> cread(<span class="keywordtype">char</span> Buf[], size_t Len) <span class="keywordflow">throw</span> ();
00230 
00231   <span class="comment">// TODO: Comparison operators</span>
00232   <span class="comment">// TODO: C++-style access functions</span>
00233 
00234 <span class="keyword">private</span>:
00235   PGconn *RawConnection() { <span class="keywordflow">return</span> LargeObject::RawConnection(m_Trans); }
00236 
00237   <span class="keywordtype">void</span> open(PGSTD::ios_base::openmode mode);
00238   <span class="keywordtype">void</span> close();
00239 
00240   TransactionItf &amp;m_Trans;
00241   <span class="keywordtype">int</span> m_fd;
00242 
00243   <span class="comment">// Not allowed:</span>
00244   LargeObjectAccess();
00245   LargeObjectAccess(<span class="keyword">const</span> LargeObjectAccess &amp;);
00246   LargeObjectAccess operator=(<span class="keyword">const</span> LargeObjectAccess &amp;);
00247 };
00248 
00249 
00250 <span class="comment">// TODO: Create i, o stream classes</span>
00251 <span class="comment">// TODO: Allow the creator to select a buffer size</span>
00253 <span class="comment">/** @warning Still experimental.  May change profoundly.</span>
00254  *
00255  * The standard streambuf classes provide uniform access to data storage such
00256  * as files or string buffers, so they can be accessed <span class="keyword">using</span> standard input or
00257  * output streams.  This streambuf implementation provides similar access to
00258  * large objects, so they can be read and written <span class="keyword">using</span> the same stream classes.
00259  */
00260 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> CHAR=<span class="keywordtype">char</span>, <span class="keyword">typename</span> TRAITS=PGSTD::<span class="keywordtype">char</span>_traits&lt;CHAR&gt; &gt;
<a name="l00261"></a><a class="code" href="classpqxx_1_1largeobject__streambuf.html">00261</a> <span class="keyword">class </span><a class="code" href="classpqxx_1_1largeobject__streambuf.html">largeobject_streambuf</a> : <span class="keyword">public</span> <a class="code" href="config_8h.html#a22">PGSTD</a>::basic_streambuf&lt;CHAR, TRAITS&gt;
00262 {
00263 <span class="keyword">public</span>:
<a name="l00264"></a><a class="code" href="classpqxx_1_1largeobject__streambuf.html#s0">00264</a>   <span class="keyword">typedef</span> CHAR   <a class="code" href="classpqxx_1_1largeobject__streambuf.html#s0">char_type</a>;
<a name="l00265"></a><a class="code" href="classpqxx_1_1largeobject__streambuf.html#s1">00265</a>   <span class="keyword">typedef</span> TRAITS <a class="code" href="classpqxx_1_1largeobject__streambuf.html#s1">traits_type</a>;
<a name="l00266"></a><a class="code" href="classpqxx_1_1largeobject__streambuf.html#s2">00266</a>   <span class="keyword">typedef</span> <span class="keyword">typename</span> traits_type::int_type <a class="code" href="classpqxx_1_1largeobject__streambuf.html#s2">int_type</a>;
<a name="l00267"></a><a class="code" href="classpqxx_1_1largeobject__streambuf.html#s3">00267</a>   <span class="keyword">typedef</span> <span class="keyword">typename</span> traits_type::pos_type <a class="code" href="classpqxx_1_1largeobject__streambuf.html#s3">pos_type</a>;
<a name="l00268"></a><a class="code" href="classpqxx_1_1largeobject__streambuf.html#s4">00268</a>   <span class="keyword">typedef</span> <span class="keyword">typename</span> traits_type::off_type <a class="code" href="classpqxx_1_1largeobject__streambuf.html#s4">off_type</a>;
00269 
<a name="l00270"></a><a class="code" href="classpqxx_1_1largeobject__streambuf.html#a0">00270</a>   <a class="code" href="classpqxx_1_1largeobject__streambuf.html#a0">largeobject_streambuf</a>(<a class="code" href="classpqxx_1_1TransactionItf.html">TransactionItf</a> &amp;T,
00271                         <a class="code" href="classpqxx_1_1LargeObject.html">LargeObject</a> O,
00272                         PGSTD::ios_base::openmode mode = 
00273                                 PGSTD::ios::in | PGSTD::ios::out) :     <span class="comment">//[t48]</span>
00274     m_BufSize(512),
00275     m_Obj(T, O),
00276     m_G(0),
00277     m_P(0)
00278   {
00279     initialize(mode);
00280   }
00281 
<a name="l00282"></a><a class="code" href="classpqxx_1_1largeobject__streambuf.html#a1">00282</a>   <a class="code" href="classpqxx_1_1largeobject__streambuf.html#a0">largeobject_streambuf</a>(<a class="code" href="classpqxx_1_1TransactionItf.html">TransactionItf</a> &amp;T,
00283                         Oid O,
00284                         PGSTD::ios_base::openmode mode = 
00285                                 PGSTD::ios::in | PGSTD::ios::out) :     <span class="comment">//[t48]</span>
00286     m_BufSize(512),
00287     m_Obj(T, O),
00288     m_G(0),
00289     m_P(0)
00290   {
00291     initialize(mode);
00292   }
00293 
<a name="l00294"></a><a class="code" href="classpqxx_1_1largeobject__streambuf.html#a2">00294</a>   <span class="keyword">virtual</span> <a class="code" href="classpqxx_1_1largeobject__streambuf.html#a2">~largeobject_streambuf</a>()
00295   {
00296     <span class="keyword">delete</span> [] m_P;
00297     <span class="keyword">delete</span> [] m_G;
00298   }
00299 
00300 
00301 <span class="keyword">protected</span>:
<a name="l00302"></a><a class="code" href="classpqxx_1_1largeobject__streambuf.html#b0">00302</a>   <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="classpqxx_1_1largeobject__streambuf.html#b0">sync</a>()
00303   {
00304     <span class="comment">// setg() sets eback, gptr, egptr</span>
00305     setg(eback(), eback(), egptr());
00306     <span class="keywordflow">return</span> <a class="code" href="classpqxx_1_1largeobject__streambuf.html#b3">overflow</a>(EoF());
00307   }
00308 
<a name="l00309"></a><a class="code" href="classpqxx_1_1largeobject__streambuf.html#b1">00309</a>   <span class="keyword">virtual</span> pos_type <a class="code" href="classpqxx_1_1largeobject__streambuf.html#b1">seekoff</a>(off_type offset, 
00310                            PGSTD::ios_base::seekdir dir,
00311                            PGSTD::ios_base::openmode mode =
00312                                 PGSTD::ios_base::in|PGSTD::ios_base::out)
00313   {
00314     <span class="keywordflow">if</span> (!mode) {}       <span class="comment">// Quench "unused parameter" warning</span>
00315     <span class="keywordflow">return</span> AdjustEOF(m_Obj.<a class="code" href="classpqxx_1_1LargeObjectAccess.html#a7">cseek</a>(offset, dir));
00316   }
00317 
<a name="l00318"></a><a class="code" href="classpqxx_1_1largeobject__streambuf.html#b2">00318</a>   <span class="keyword">virtual</span> pos_type <a class="code" href="classpqxx_1_1largeobject__streambuf.html#b2">seekpos</a>(pos_type pos, 
00319                            PGSTD::ios_base::openmode mode =
00320                                 PGSTD::ios_base::in|PGSTD::ios_base::out)
00321   {
00322     <span class="keywordflow">if</span> (!mode) {}       <span class="comment">// Quench "unused parameter" warning</span>
00323     <span class="keywordflow">return</span> AdjustEOF(m_Obj.<a class="code" href="classpqxx_1_1LargeObjectAccess.html#a7">cseek</a>(pos, PGSTD::ios_base::beg));
00324   }
00325 
<a name="l00326"></a><a class="code" href="classpqxx_1_1largeobject__streambuf.html#b3">00326</a>   <span class="keyword">virtual</span> int_type <a class="code" href="classpqxx_1_1largeobject__streambuf.html#b3">overflow</a>(int_type ch = EoF())
00327   {
00328     <span class="keywordtype">char</span> *<span class="keyword">const</span> pp = pptr();
00329     <span class="keywordflow">if</span> (!pp) <span class="keywordflow">return</span> EoF();
00330     <span class="keywordtype">char</span> *<span class="keyword">const</span> pb = pbase();
00331     int_type result = 0;
00332 
00333     <span class="keywordflow">if</span> (pp &gt; pb) result = AdjustEOF(m_Obj.<a class="code" href="classpqxx_1_1LargeObjectAccess.html#a8">cwrite</a>(pb, pp-pb));
00334     setp(m_P, m_P + m_BufSize);
00335 
00336     <span class="comment">// Write that one more character, if it's there.</span>
00337     <span class="keywordflow">if</span> (ch != EoF())
00338     {
00339       *pptr() = char(ch);
00340       pbump(1);
00341     }
00342     <span class="keywordflow">return</span> result;
00343   }
00344 
<a name="l00345"></a><a class="code" href="classpqxx_1_1largeobject__streambuf.html#b4">00345</a>   <span class="keyword">virtual</span> int_type <a class="code" href="classpqxx_1_1largeobject__streambuf.html#b4">underflow</a>()
00346   {
00347     <span class="keywordflow">if</span> (!gptr()) <span class="keywordflow">return</span> EoF();
00348     <span class="keywordtype">char</span> *<span class="keyword">const</span> eb = eback();
00349     <span class="keyword">const</span> <span class="keywordtype">int</span> result = AdjustEOF(m_Obj.<a class="code" href="classpqxx_1_1LargeObjectAccess.html#a9">cread</a>(eback(), m_BufSize));
00350     setg(eb, eb, eb + ((result==EoF()) ? 0 : result));
00351     <span class="keywordflow">return</span> (!result || (result == EoF())) ? EoF() : *eb;
00352   }
00353 
00354 <span class="keyword">private</span>:
00356   <span class="keyword">static</span> int_type EoF() { <span class="keywordflow">return</span> traits_type::eof(); }
00357 
00359   <span class="keyword">static</span> PGSTD::streampos AdjustEOF(<span class="keywordtype">int</span> pos)
00360   {
00361     <span class="keywordflow">return</span> (pos == -1) ? EoF() : pos;
00362   }
00363 
00364   <span class="keywordtype">void</span> initialize(PGSTD::ios_base::openmode mode)
00365   {
00366     <span class="keywordflow">if</span> (mode &amp; PGSTD::ios_base::in) 
00367     {
00368       m_G = <span class="keyword">new</span> char_type[m_BufSize];
00369       setg(m_G, m_G, m_G);
00370     }
00371     <span class="keywordflow">if</span> (mode &amp; PGSTD::ios_base::out)
00372     {
00373       m_P = <span class="keyword">new</span> char_type[m_BufSize];
00374       setp(m_P, m_P + m_BufSize);
00375     }
00376   }
00377 
00378   <span class="keyword">const</span> size_t m_BufSize;
00379   LargeObjectAccess m_Obj;
00380 
00381   <span class="comment">// Get &amp; put buffers</span>
00382   char_type *m_G, *m_P;
00383 };
00384 
00385 
00386 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> CHAR=<span class="keywordtype">char</span>, <span class="keyword">typename</span> TRAITS=PGSTD::<span class="keywordtype">char</span>_traits&lt;CHAR&gt; &gt; 
<a name="l00387"></a><a class="code" href="classpqxx_1_1basic__ilostream.html">00387</a> <span class="keyword">class </span><a class="code" href="classpqxx_1_1basic__ilostream.html">basic_ilostream</a> : <span class="keyword">public</span> <a class="code" href="config_8h.html#a22">PGSTD</a>::basic_istream&lt;CHAR, TRAITS&gt;
00388 {
00389 <span class="keyword">public</span>:
<a name="l00390"></a><a class="code" href="classpqxx_1_1basic__ilostream.html#s0">00390</a>   <span class="keyword">typedef</span> CHAR char_type;
<a name="l00391"></a><a class="code" href="classpqxx_1_1basic__ilostream.html#s1">00391</a>   <span class="keyword">typedef</span> TRAITS traits_type;
<a name="l00392"></a><a class="code" href="classpqxx_1_1basic__ilostream.html#s2">00392</a>   <span class="keyword">typedef</span> <span class="keyword">typename</span> traits_type::int_type int_type;
<a name="l00393"></a><a class="code" href="classpqxx_1_1basic__ilostream.html#s3">00393</a>   <span class="keyword">typedef</span> <span class="keyword">typename</span> traits_type::pos_type pos_type;
<a name="l00394"></a><a class="code" href="classpqxx_1_1basic__ilostream.html#s4">00394</a>   <span class="keyword">typedef</span> <span class="keyword">typename</span> traits_type::off_type off_type;
00395 
<a name="l00396"></a><a class="code" href="classpqxx_1_1basic__ilostream.html#a0">00396</a>   <a class="code" href="classpqxx_1_1basic__ilostream.html#a0">basic_ilostream</a>(<a class="code" href="classpqxx_1_1TransactionItf.html">TransactionItf</a> &amp;T, <a class="code" href="classpqxx_1_1LargeObject.html">LargeObject</a> O) :
00397     <a class="code" href="config_8h.html#a22">PGSTD</a>::basic_istream&lt;CHAR,TRAITS&gt;(&amp;m_Buf),
00398     m_Buf(T, O, <a class="code" href="config_8h.html#a22">PGSTD</a>::ios_base::in) 
00399   { 
00400   }
00401 
<a name="l00402"></a><a class="code" href="classpqxx_1_1basic__ilostream.html#a1">00402</a>   <a class="code" href="classpqxx_1_1basic__ilostream.html#a0">basic_ilostream</a>(<a class="code" href="classpqxx_1_1TransactionItf.html">TransactionItf</a> &amp;T, Oid O) :
00403     <a class="code" href="config_8h.html#a22">PGSTD</a>::basic_istream&lt;CHAR,TRAITS&gt;(&amp;m_Buf),
00404     m_Buf(T, O, <a class="code" href="config_8h.html#a22">PGSTD</a>::ios_base::in) 
00405   { 
00406   }
00407 
00408 <span class="keyword">private</span>:
00409   largeobject_streambuf&lt;CHAR,TRAITS&gt; m_Buf;
00410 };
00411 
<a name="l00412"></a><a class="code" href="namespacepqxx.html#a1">00412</a> <span class="keyword">typedef</span> <a class="code" href="classpqxx_1_1basic__ilostream.html">basic_ilostream&lt;char&gt;</a> <a class="code" href="namespacepqxx.html#a1">ilostream</a>;
00413 
00414 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> CHAR=<span class="keywordtype">char</span>, <span class="keyword">typename</span> TRAITS=PGSTD::<span class="keywordtype">char</span>_traits&lt;CHAR&gt; &gt; 
<a name="l00415"></a><a class="code" href="classpqxx_1_1basic__olostream.html">00415</a> <span class="keyword">class </span><a class="code" href="classpqxx_1_1basic__olostream.html">basic_olostream</a> : <span class="keyword">public</span> <a class="code" href="config_8h.html#a22">PGSTD</a>::basic_ostream&lt;CHAR, TRAITS&gt;
00416 {
00417 <span class="keyword">public</span>:
<a name="l00418"></a><a class="code" href="classpqxx_1_1basic__olostream.html#s0">00418</a>   <span class="keyword">typedef</span> CHAR char_type;
<a name="l00419"></a><a class="code" href="classpqxx_1_1basic__olostream.html#s1">00419</a>   <span class="keyword">typedef</span> TRAITS traits_type;
<a name="l00420"></a><a class="code" href="classpqxx_1_1basic__olostream.html#s2">00420</a>   <span class="keyword">typedef</span> <span class="keyword">typename</span> traits_type::int_type int_type;
<a name="l00421"></a><a class="code" href="classpqxx_1_1basic__olostream.html#s3">00421</a>   <span class="keyword">typedef</span> <span class="keyword">typename</span> traits_type::pos_type pos_type;
<a name="l00422"></a><a class="code" href="classpqxx_1_1basic__olostream.html#s4">00422</a>   <span class="keyword">typedef</span> <span class="keyword">typename</span> traits_type::off_type off_type;
00423 
<a name="l00424"></a><a class="code" href="classpqxx_1_1basic__olostream.html#a0">00424</a>   <a class="code" href="classpqxx_1_1basic__olostream.html#a0">basic_olostream</a>(<a class="code" href="classpqxx_1_1TransactionItf.html">TransactionItf</a> &amp;T, <a class="code" href="classpqxx_1_1LargeObject.html">LargeObject</a> O) :
00425     <a class="code" href="config_8h.html#a22">PGSTD</a>::basic_ostream&lt;CHAR,TRAITS&gt;(&amp;m_Buf),
00426     m_Buf(T, O, <a class="code" href="config_8h.html#a22">PGSTD</a>::ios_base::out) 
00427   { 
00428   }
00429 
<a name="l00430"></a><a class="code" href="classpqxx_1_1basic__olostream.html#a1">00430</a>   <a class="code" href="classpqxx_1_1basic__olostream.html#a0">basic_olostream</a>(<a class="code" href="classpqxx_1_1TransactionItf.html">TransactionItf</a> &amp;T, Oid O) :
00431     <a class="code" href="config_8h.html#a22">PGSTD</a>::basic_ostream&lt;CHAR,TRAITS&gt;(&amp;m_Buf),
00432     m_Buf(T, O, <a class="code" href="config_8h.html#a22">PGSTD</a>::ios_base::out) 
00433   { 
00434   }
00435 
<a name="l00436"></a><a class="code" href="classpqxx_1_1basic__olostream.html#a2">00436</a>   <a class="code" href="classpqxx_1_1basic__olostream.html#a2">~basic_olostream</a>() { m_Buf.pubsync(); m_Buf.pubsync(); }
00437 
00438 <span class="keyword">private</span>:
00439   largeobject_streambuf&lt;CHAR,TRAITS&gt; m_Buf;
00440 };
00441 
<a name="l00442"></a><a class="code" href="namespacepqxx.html#a2">00442</a> <span class="keyword">typedef</span> <a class="code" href="classpqxx_1_1basic__olostream.html">basic_olostream&lt;char&gt;</a> <a class="code" href="namespacepqxx.html#a2">olostream</a>;
00443 
00444 
00445 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> CHAR=<span class="keywordtype">char</span>, <span class="keyword">typename</span> TRAITS=PGSTD::<span class="keywordtype">char</span>_traits&lt;CHAR&gt; &gt; 
<a name="l00446"></a><a class="code" href="classpqxx_1_1basic__lostream.html">00446</a> <span class="keyword">class </span><a class="code" href="classpqxx_1_1basic__lostream.html">basic_lostream</a> : <span class="keyword">public</span> <a class="code" href="config_8h.html#a22">PGSTD</a>::basic_iostream&lt;CHAR, TRAITS&gt;
00447 {
00448 <span class="keyword">public</span>:
<a name="l00449"></a><a class="code" href="classpqxx_1_1basic__lostream.html#s0">00449</a>   <span class="keyword">typedef</span> CHAR char_type;
<a name="l00450"></a><a class="code" href="classpqxx_1_1basic__lostream.html#s1">00450</a>   <span class="keyword">typedef</span> TRAITS traits_type;
<a name="l00451"></a><a class="code" href="classpqxx_1_1basic__lostream.html#s2">00451</a>   <span class="keyword">typedef</span> <span class="keyword">typename</span> traits_type::int_type int_type;
<a name="l00452"></a><a class="code" href="classpqxx_1_1basic__lostream.html#s3">00452</a>   <span class="keyword">typedef</span> <span class="keyword">typename</span> traits_type::pos_type pos_type;
<a name="l00453"></a><a class="code" href="classpqxx_1_1basic__lostream.html#s4">00453</a>   <span class="keyword">typedef</span> <span class="keyword">typename</span> traits_type::off_type off_type;
00454 
<a name="l00455"></a><a class="code" href="classpqxx_1_1basic__lostream.html#a0">00455</a>   <a class="code" href="classpqxx_1_1basic__lostream.html#a0">basic_lostream</a>(<a class="code" href="classpqxx_1_1TransactionItf.html">TransactionItf</a> &amp;T, <a class="code" href="classpqxx_1_1LargeObject.html">LargeObject</a> O) :
00456     <a class="code" href="config_8h.html#a22">PGSTD</a>::basic_iostream&lt;CHAR,TRAITS&gt;(&amp;m_Buf),
00457     m_Buf(T, O) 
00458   { 
00459   }
00460 
<a name="l00461"></a><a class="code" href="classpqxx_1_1basic__lostream.html#a1">00461</a>   <a class="code" href="classpqxx_1_1basic__lostream.html#a0">basic_lostream</a>(<a class="code" href="classpqxx_1_1TransactionItf.html">TransactionItf</a> &amp;T, Oid O) :
00462     <a class="code" href="config_8h.html#a22">PGSTD</a>::basic_iostream&lt;CHAR,TRAITS&gt;(&amp;m_Buf),
00463     m_Buf(T, O) 
00464   { 
00465   }
00466 
<a name="l00467"></a><a class="code" href="classpqxx_1_1basic__lostream.html#a2">00467</a>   <a class="code" href="classpqxx_1_1basic__lostream.html#a2">~basic_lostream</a>() { m_Buf.pubsync(); m_Buf.pubsync(); }
00468 
00469 <span class="keyword">private</span>:
00470   largeobject_streambuf&lt;CHAR,TRAITS&gt; m_Buf;
00471 };
00472 
<a name="l00473"></a><a class="code" href="namespacepqxx.html#a3">00473</a> <span class="keyword">typedef</span> <a class="code" href="classpqxx_1_1basic__lostream.html">basic_lostream&lt;char&gt;</a> <a class="code" href="namespacepqxx.html#a3">lostream</a>;
00474 
00475 }
00476 
00477 <span class="preprocessor">#endif</span>
00478 <span class="preprocessor"></span>
</pre></div><hr><address style="align: right;"><small>Generated on Tue Mar 11 12:42:48 2003 for libpqxx by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
