<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>libpqxx: result.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.1 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>result.h</h1><a href="result_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*-------------------------------------------------------------------------</span>
00002 <span class="comment"> *</span>
00003 <span class="comment"> *   FILE</span>
00004 <span class="comment"> *      pqxx/result.h</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> *   DESCRIPTION</span>
00007 <span class="comment"> *      definitions for the pqxx::result class and support classes.</span>
00008 <span class="comment"> *   pqxx::result represents the set of result tuples from a database query</span>
00009 <span class="comment"> *</span>
00010 <span class="comment"> * Copyright (c) 2001-2003, Jeroen T. Vermeulen &lt;jtv@xs4all.nl&gt;</span>
00011 <span class="comment"> *</span>
00012 <span class="comment"> * See COPYING for copyright license.  If you did not receive a file called</span>
00013 <span class="comment"> * COPYING with this source code, please notify the distributor of this mistake,</span>
00014 <span class="comment"> * or contact the author.</span>
00015 <span class="comment"> *</span>
00016 <span class="comment"> *-------------------------------------------------------------------------</span>
00017 <span class="comment"> */</span>
00018 <span class="preprocessor">#ifndef PQXX_RESULT_H</span>
00019 <span class="preprocessor"></span><span class="preprocessor">#define PQXX_RESULT_H</span>
00020 <span class="preprocessor"></span>
00021 <span class="preprocessor">#include &lt;stdexcept&gt;</span>
00022 
00023 <span class="preprocessor">#include "<a class="code" href="util_8h.html">pqxx/util.h</a>"</span>
00024 
00025 <span class="comment">/* Methods tested in eg. self-test program test1 are marked with "//[t1]"</span>
00026 <span class="comment"> */</span>
00027 
00028 
00029 <span class="comment">// TODO: Support postgres arrays</span>
00030 
00031 <span class="keyword">namespace </span>pqxx
00032 {
00033 
00035 
<a name="l00042"></a><a class="code" href="classpqxx_1_1result.html">00042</a> <span class="keyword">class </span>PQXX_LIBEXPORT result
00043 {
00044 <span class="keyword">public</span>:
<a name="l00045"></a><a class="code" href="classpqxx_1_1result.html#a0">00045</a>   result() : m_Result(0), m_Refcount(0) {}                              <span class="comment">//[t3]</span>
<a name="l00046"></a><a class="code" href="classpqxx_1_1result.html#a1">00046</a>   result(<span class="keyword">const</span> result &amp;rhs) :                                           <span class="comment">//[t1]</span>
00047           m_Result(0), m_Refcount(0) { MakeRef(rhs); }
<a name="l00048"></a><a class="code" href="classpqxx_1_1result.html#a2">00048</a>   ~result() { LoseRef(); }                                              <span class="comment">//[t1]</span>
00049   
00050   result &amp;operator=(<span class="keyword">const</span> result &amp;);                                    <span class="comment">//[t10]</span>
00051 
<a name="l00052"></a><a class="code" href="classpqxx_1_1result.html#w0">00052</a>   <span class="keyword">typedef</span> <a class="code" href="namespacepqxx.html#a22">result_size_type</a> size_type;
00053   <span class="keyword">class </span><a class="code" href="classpqxx_1_1result_1_1field.html">field</a>;
00054 
00055   <span class="comment">// TODO: Field iterators</span>
00056  
00058 
<a name="l00066"></a><a class="code" href="classpqxx_1_1result_1_1tuple.html">00066</a>   <span class="keyword">class </span>PQXX_LIBEXPORT tuple
00067   {
00068   <span class="keyword">public</span>:
<a name="l00069"></a><a class="code" href="classpqxx_1_1result_1_1tuple.html#w0">00069</a>     <span class="keyword">typedef</span> <a class="code" href="namespacepqxx.html#a23">tuple_size_type</a> size_type;
<a name="l00070"></a><a class="code" href="classpqxx_1_1result_1_1tuple.html#a0">00070</a>     tuple(<span class="keyword">const</span> result *r, result::size_type i) : m_Home(r), m_Index(i) {}
<a name="l00071"></a><a class="code" href="classpqxx_1_1result_1_1tuple.html#a1">00071</a>     ~tuple() {} <span class="comment">// Yes Scott Meyers, you're absolutely right[1]</span>
00072 
00073     <span class="keyword">inline</span> field operator[](size_type) <span class="keyword">const</span>;                           <span class="comment">//[t1]</span>
00074     field operator[](<span class="keyword">const</span> <span class="keywordtype">char</span>[]) <span class="keyword">const</span>;                               <span class="comment">//[t11]</span>
<a name="l00075"></a><a class="code" href="classpqxx_1_1result_1_1tuple.html#a4">00075</a>     <a class="code" href="classpqxx_1_1result_1_1field.html">field</a> operator[](<span class="keyword">const</span> PGSTD::string &amp;s) <span class="keyword">const</span>                      <span class="comment">//[t11]</span>
00076         { <span class="keywordflow">return</span> operator[](s.c_str()); }
00077     field at(size_type) <span class="keyword">const</span>;                                          <span class="comment">//[t10]</span>
00078     field at(<span class="keyword">const</span> <span class="keywordtype">char</span>[]) <span class="keyword">const</span>;                                       <span class="comment">//[t11]</span>
<a name="l00079"></a><a class="code" href="classpqxx_1_1result_1_1tuple.html#a7">00079</a>     <a class="code" href="classpqxx_1_1result_1_1field.html">field</a> at(<span class="keyword">const</span> PGSTD::string &amp;s)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> at(s.c_str()); }    <span class="comment">//[t11]</span>
00080 
00081     <span class="keyword">inline</span> size_type size() <span class="keyword">const</span>;                                      <span class="comment">//[t11]</span>
00082 
<a name="l00083"></a><a class="code" href="classpqxx_1_1result_1_1tuple.html#a9">00083</a>     result::size_type Row()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_Index; }                   <span class="comment">//[t11]</span>
00084 
<a name="l00086"></a><a class="code" href="classpqxx_1_1result_1_1tuple.html#a10">00086</a>     size_type ColumnNumber(<span class="keyword">const</span> PGSTD::string &amp;ColName) <span class="keyword">const</span>          <span class="comment">//[t30]</span>
00087         { <span class="keywordflow">return</span> m_Home-&gt;<a class="code" href="classpqxx_1_1result_1_1tuple.html#a10">ColumnNumber</a>(ColName); }
00088 
<a name="l00090"></a><a class="code" href="classpqxx_1_1result_1_1tuple.html#a11">00090</a>     size_type ColumnNumber(<span class="keyword">const</span> <span class="keywordtype">char</span> ColName[]) <span class="keyword">const</span>                  <span class="comment">//[t30]</span>
00091         { <span class="keywordflow">return</span> m_Home-&gt;ColumnNumber(ColName); }
00092 
<a name="l00094"></a><a class="code" href="classpqxx_1_1result_1_1tuple.html#a12">00094</a>     size_type column_number(<span class="keyword">const</span> PGSTD::string &amp;ColName) <span class="keyword">const</span>         <span class="comment">//[]</span>
00095         { <span class="keywordflow">return</span> m_Home-&gt;column_number(ColName); }
00096 
<a name="l00098"></a><a class="code" href="classpqxx_1_1result_1_1tuple.html#a13">00098</a>     size_type column_number(<span class="keyword">const</span> <span class="keywordtype">char</span> ColName[]) <span class="keyword">const</span>                 <span class="comment">//[]</span>
00099         { <span class="keywordflow">return</span> m_Home-&gt;column_number(ColName); }
00100 
00101   <span class="keyword">protected</span>:
<a name="l00102"></a><a class="code" href="classpqxx_1_1result_1_1tuple.html#p0">00102</a>     <span class="keyword">const</span> result *m_Home;
<a name="l00103"></a><a class="code" href="classpqxx_1_1result_1_1tuple.html#p1">00103</a>     result::size_type m_Index;
00104 
00105     <span class="comment">// Not allowed:</span>
00106     tuple();
00107   };
00108 
<a name="l00110"></a><a class="code" href="classpqxx_1_1result.html#w1">00110</a>   <span class="keyword">typedef</span> tuple <a class="code" href="classpqxx_1_1result_1_1tuple.html">Tuple</a>;
00111 
00112 
00114 
<a name="l00117"></a><a class="code" href="classpqxx_1_1result_1_1field.html">00117</a>   <span class="keyword">class </span>PQXX_LIBEXPORT field : <span class="keyword">private</span> tuple
00118   {
00119   <span class="keyword">public</span>:
<a name="l00120"></a><a class="code" href="classpqxx_1_1result_1_1field.html#w0">00120</a>     <span class="keyword">typedef</span> size_t size_type;
00121 
00123 
<a name="l00127"></a><a class="code" href="classpqxx_1_1result_1_1field.html#a0">00127</a>     field(<span class="keyword">const</span> tuple &amp;R, tuple::size_type C) : tuple(R), m_Col(C) {}   <span class="comment">//[t1]</span>
00128 
00130 
<a name="l00135"></a><a class="code" href="classpqxx_1_1result_1_1field.html#a1">00135</a>     <span class="keyword">const</span> <span class="keywordtype">char</span> *c_str()<span class="keyword"> const </span>{<span class="keywordflow">return</span> m_Home-&gt;GetValue(m_Index,m_Col);} <span class="comment">//[t2]</span>
00136 
00138     <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *Name() <span class="keyword">const</span>;                                    <span class="comment">//[t11]</span>
00139 
00141 
<a name="l00150"></a><a class="code" href="classpqxx_1_1result_1_1field.html#a3">00150</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">bool</span> to(T &amp;Obj) <span class="keyword">const</span>                          <span class="comment">//[t1]</span>
00151     {
00152       <span class="keywordflow">if</span> (is_null())
00153         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00154 
00155       <span class="keywordflow">try</span>
00156       {
00157         <a class="code" href="namespacepqxx.html#a51">FromString</a>(c_str(), Obj);
00158       }
00159       <span class="keywordflow">catch</span> (<span class="keyword">const</span> PGSTD::exception &amp;e)
00160       {
00161         <span class="keywordflow">throw</span> PGSTD::runtime_error(<span class="stringliteral">"Error reading field "</span> + 
00162                                    PGSTD::string(Name()) +
00163                                    <span class="stringliteral">": "</span> +
00164                                    e.what());
00165       }
00166       <span class="keywordflow">return</span> <span class="keyword">true</span>;
00167     }
00168 
00169 
00170 <span class="preprocessor">#ifdef NO_PARTIAL_CLASS_TEMPLATE_SPECIALISATION</span>
00171 <span class="preprocessor"></span>
00172     <span class="keyword">template</span>&lt;&gt; <span class="keywordtype">bool</span> to&lt;PGSTD::string&gt;(PGSTD::string &amp;Obj) <span class="keyword">const</span>;
00173 
00175 
00178     <span class="keyword">template</span>&lt;&gt; <span class="keywordtype">bool</span> to&lt;const char *&gt;(<span class="keyword">const</span> <span class="keywordtype">char</span> *&amp;Obj) <span class="keyword">const</span>;
00179 <span class="preprocessor">#endif</span>
00180 <span class="preprocessor"></span>
00181 
<a name="l00183"></a><a class="code" href="classpqxx_1_1result_1_1field.html#a4">00183</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">bool</span> to(T &amp;Obj, <span class="keyword">const</span> T &amp;Default) <span class="keyword">const</span>        <span class="comment">//[t12]</span>
00184     {
00185       <span class="keyword">const</span> <span class="keywordtype">bool</span> NotNull = to(Obj);
00186       <span class="keywordflow">if</span> (!NotNull)
00187         Obj = Default;
00188       <span class="keywordflow">return</span> NotNull;
00189     }
00190 
00192 
<a name="l00195"></a><a class="code" href="classpqxx_1_1result_1_1field.html#a5">00195</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; T as(<span class="keyword">const</span> T &amp;Default) <span class="keyword">const</span>                   <span class="comment">//[t45]</span>
00196     {
00197       T Obj;
00198       <span class="keywordflow">return</span> to(Obj) ? Obj : Default;
00199     }
00200 
<a name="l00201"></a><a class="code" href="classpqxx_1_1result_1_1field.html#a6">00201</a>     <span class="keywordtype">bool</span> is_null()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_Home-&gt;GetIsNull(m_Index,m_Col); }   <span class="comment">//[t12]</span>
00202 
<a name="l00203"></a><a class="code" href="classpqxx_1_1result_1_1field.html#a7">00203</a>     size_type size()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_Home-&gt;GetLength(m_Index,m_Col); } <span class="comment">//[t11]</span>
00204 
00205   <span class="keyword">private</span>:
00206 
00207     tuple::size_type m_Col;
00208   };
00209 
<a name="l00211"></a><a class="code" href="classpqxx_1_1result.html#w2">00211</a>   <span class="keyword">typedef</span> field <a class="code" href="classpqxx_1_1result_1_1field.html">Field</a>;
00212 
00214 
<a name="l00218"></a><a class="code" href="classpqxx_1_1result_1_1const__iterator.html">00218</a>   <span class="keyword">class </span>PQXX_LIBEXPORT const_iterator : 
00219     <span class="keyword">public</span> <a class="code" href="config_8h.html#a25">PGSTD</a>::iterator&lt;PGSTD::random_access_iterator_tag, 
00220                          const tuple,
00221                          result::size_type&gt;, 
00222     <span class="keyword">public</span> tuple
00223   {
00224   <span class="keyword">public</span>:
<a name="l00225"></a><a class="code" href="classpqxx_1_1result_1_1const__iterator.html#a0">00225</a>     const_iterator() : tuple(0,0) {}
00226 
<a name="l00233"></a><a class="code" href="classpqxx_1_1result_1_1const__iterator.html#a1">00233</a>     pointer operator-&gt;()  <span class="keyword">const</span> { <span class="keywordflow">return</span> <span class="keyword">this</span>; }                        <span class="comment">//[t12]</span>
<a name="l00234"></a><a class="code" href="classpqxx_1_1result_1_1const__iterator.html#a2">00234</a>     reference operator*()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> *operator-&gt;(); }               <span class="comment">//[t12]</span>
00235 
00236     const_iterator operator++(<span class="keywordtype">int</span>);                                     <span class="comment">//[t12]</span>
<a name="l00237"></a><a class="code" href="classpqxx_1_1result_1_1const__iterator.html#a4">00237</a>     const_iterator &amp;operator++() { ++m_Index; <span class="keywordflow">return</span> *<span class="keyword">this</span>; }           <span class="comment">//[t1]</span>
00238     const_iterator operator--(<span class="keywordtype">int</span>);                                     <span class="comment">//[t12]</span>
<a name="l00239"></a><a class="code" href="classpqxx_1_1result_1_1const__iterator.html#a6">00239</a>     const_iterator &amp;operator--() { --m_Index; <span class="keywordflow">return</span> *<span class="keyword">this</span>; }           <span class="comment">//[t12]</span>
00240 
<a name="l00241"></a><a class="code" href="classpqxx_1_1result_1_1const__iterator.html#a7">00241</a>     const_iterator &amp;operator+=(difference_type i)                       <span class="comment">//[t12]</span>
00242         { m_Index+=i; <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
<a name="l00243"></a><a class="code" href="classpqxx_1_1result_1_1const__iterator.html#a8">00243</a>     const_iterator &amp;operator-=(difference_type i)                       <span class="comment">//[t12]</span>
00244         { m_Index-=i; <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
00245 
<a name="l00246"></a><a class="code" href="classpqxx_1_1result_1_1const__iterator.html#a9">00246</a>     <span class="keywordtype">bool</span> operator==(<span class="keyword">const</span> const_iterator &amp;i) <span class="keyword">const</span>                      <span class="comment">//[t12]</span>
00247         {<span class="keywordflow">return</span> m_Index==i.m_Index;}
<a name="l00248"></a><a class="code" href="classpqxx_1_1result_1_1const__iterator.html#a10">00248</a>     <span class="keywordtype">bool</span> operator!=(<span class="keyword">const</span> const_iterator &amp;i) <span class="keyword">const</span>                      <span class="comment">//[t12]</span>
00249         {<span class="keywordflow">return</span> m_Index!=i.m_Index;}
<a name="l00250"></a><a class="code" href="classpqxx_1_1result_1_1const__iterator.html#a11">00250</a>     <span class="keywordtype">bool</span> operator&lt;(<span class="keyword">const</span> const_iterator &amp;i) <span class="keyword">const</span>                       <span class="comment">//[t12]</span>
00251          {<span class="keywordflow">return</span> m_Index&lt;i.m_Index;}
<a name="l00252"></a><a class="code" href="classpqxx_1_1result_1_1const__iterator.html#a12">00252</a>     <span class="keywordtype">bool</span> operator&lt;=(<span class="keyword">const</span> const_iterator &amp;i) <span class="keyword">const</span>                      <span class="comment">//[t12]</span>
00253         {<span class="keywordflow">return</span> m_Index&lt;=i.m_Index;}
<a name="l00254"></a><a class="code" href="classpqxx_1_1result_1_1const__iterator.html#a13">00254</a>     <span class="keywordtype">bool</span> operator&gt;(<span class="keyword">const</span> const_iterator &amp;i) <span class="keyword">const</span>                       <span class="comment">//[t12]</span>
00255         {<span class="keywordflow">return</span> m_Index&gt;i.m_Index;}
<a name="l00256"></a><a class="code" href="classpqxx_1_1result_1_1const__iterator.html#a14">00256</a>     <span class="keywordtype">bool</span> operator&gt;=(<span class="keyword">const</span> const_iterator &amp;i) <span class="keyword">const</span>                      <span class="comment">//[t12]</span>
00257         {<span class="keywordflow">return</span> m_Index&gt;=i.m_Index;}
00258 
00259     <span class="keyword">inline</span> const_iterator <a class="code" href="namespacepqxx.html#a30">operator+</a>(difference_type o) <span class="keyword">const</span>;           <span class="comment">//[t12]</span>
00260 
00261     <span class="keyword">friend</span> const_iterator <a class="code" href="namespacepqxx.html#a30">operator+</a>(difference_type o, 
00262                                     const_iterator i);                  <span class="comment">//[t12]</span>
00263 
00264     <span class="keyword">inline</span> const_iterator operator-(difference_type o) <span class="keyword">const</span>;           <span class="comment">//[t12]</span>
00265 
00266     <span class="keyword">inline</span> difference_type operator-(const_iterator i) <span class="keyword">const</span>;           <span class="comment">//[t12]</span>
00267 
<a name="l00268"></a><a class="code" href="classpqxx_1_1result_1_1const__iterator.html#a18">00268</a>     result::size_type num()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> Row(); }                     <span class="comment">//[t1]</span>
00269 
00270   <span class="keyword">private</span>:
<a name="l00271"></a><a class="code" href="classpqxx_1_1result_1_1const__iterator.html#n0">00271</a>     <span class="keyword">friend</span> <span class="keyword">class </span>result;
00272     const_iterator(<span class="keyword">const</span> result *r, result::size_type i) : tuple(r, i) {}
00273   };
00274 
<a name="l00275"></a><a class="code" href="classpqxx_1_1result.html#a4">00275</a>   const_iterator begin()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> const_iterator(<span class="keyword">this</span>, 0); }      <span class="comment">//[t1]</span>
00276   <span class="keyword">inline</span> const_iterator end() <span class="keyword">const</span>;                                    <span class="comment">//[t1]</span>
00277   <span class="comment">// TODO: Reverse iterators</span>
00278 
<a name="l00279"></a><a class="code" href="classpqxx_1_1result.html#a6">00279</a>   size_type size()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_Result ? PQntuples(m_Result) : 0; } <span class="comment">//[t2]</span>
<a name="l00280"></a><a class="code" href="classpqxx_1_1result.html#a7">00280</a>   <span class="keywordtype">bool</span> empty()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> !m_Result || !PQntuples(m_Result); }      <span class="comment">//[t11]</span>
<a name="l00281"></a><a class="code" href="classpqxx_1_1result.html#a8">00281</a>   size_type capacity()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> size(); }                         <span class="comment">//[t20]</span>
00282 
<a name="l00283"></a><a class="code" href="classpqxx_1_1result.html#a9">00283</a>   <span class="keyword">const</span> tuple operator[](size_type i)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> tuple(<span class="keyword">this</span>, i); }  <span class="comment">//[t2]</span>
00284   <span class="keyword">const</span> tuple at(size_type) <span class="keyword">const</span>;                                      <span class="comment">//[t10]</span>
00285 
<a name="l00286"></a><a class="code" href="classpqxx_1_1result.html#a11">00286</a>   <span class="keywordtype">void</span> clear() { LoseRef(); }                                           <span class="comment">//[t20]</span>
00287 
<a name="l00288"></a><a class="code" href="classpqxx_1_1result.html#a12">00288</a>   tuple::size_type Columns()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> PQnfields(m_Result); }      <span class="comment">//[t11]</span>
00289 
<a name="l00291"></a><a class="code" href="classpqxx_1_1result.html#a13">00291</a>   tuple::size_type ColumnNumber(<span class="keyword">const</span> <span class="keywordtype">char</span> Name[]) <span class="keyword">const</span>                <span class="comment">//[t11]</span>
00292         {<span class="keywordflow">return</span> PQfnumber(m_Result,Name);}
<a name="l00294"></a><a class="code" href="classpqxx_1_1result.html#a14">00294</a>   tuple::size_type ColumnNumber(<span class="keyword">const</span> PGSTD::string &amp;Name) <span class="keyword">const</span>        <span class="comment">//[t11]</span>
00295         {<span class="keywordflow">return</span> ColumnNumber(Name.c_str());}
<a name="l00297"></a><a class="code" href="classpqxx_1_1result.html#a15">00297</a>   <span class="keyword">const</span> <span class="keywordtype">char</span> *ColumnName(tuple::size_type Number) <span class="keyword">const</span>                 <span class="comment">//[t11]</span>
00298         {<span class="keywordflow">return</span> PQfname(m_Result,Number);}
00299 
00301   tuple::size_type column_number(<span class="keyword">const</span> <span class="keywordtype">char</span> ColName[]) <span class="keyword">const</span>;           <span class="comment">//[]</span>
00302 
<a name="l00304"></a><a class="code" href="classpqxx_1_1result.html#a17">00304</a>   tuple::size_type column_number(<span class="keyword">const</span> PGSTD::string &amp;Name) <span class="keyword">const</span>       <span class="comment">//[]</span>
00305         {<span class="keywordflow">return</span> column_number(Name.c_str());}
00306 
00308   <span class="keyword">const</span> <span class="keywordtype">char</span> *column_name(tuple::size_type Number) <span class="keyword">const</span>;               <span class="comment">//[]</span>
00309 
00311 
<a name="l00313"></a><a class="code" href="classpqxx_1_1result.html#a19">00313</a>   <a class="code" href="namespacepqxx.html#a24">oid</a> InsertedOid()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> PQoidValue(m_Result); }              <span class="comment">//[t13]</span>
00314 
00316   <span class="comment">/*** Returns zero for all other commands. */</span>
00317   size_type AffectedRows() <span class="keyword">const</span>;                                       <span class="comment">//[t7]</span>
00318 
00319 <span class="keyword">private</span>:
00320   PGresult *m_Result;
00321   <span class="keyword">mutable</span> <span class="keywordtype">int</span> *m_Refcount;
00322 
<a name="l00323"></a><a class="code" href="classpqxx_1_1result.html#n0">00323</a>   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classpqxx_1_1result_1_1field.html">result::field</a>;
00324   <span class="keyword">const</span> <span class="keywordtype">char</span> *GetValue(size_type Row, tuple::size_type Col) <span class="keyword">const</span>;
00325   <span class="keywordtype">bool</span> GetIsNull(size_type Row, tuple::size_type Col) <span class="keyword">const</span>;
00326   field::size_type GetLength(size_type Row, tuple::size_type Col) <span class="keyword">const</span>;
00327 
<a name="l00328"></a><a class="code" href="classpqxx_1_1result.html#n1">00328</a>   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classpqxx_1_1connection__base.html">connection_base</a>;
00329   <span class="keyword">explicit</span> result(PGresult *rhs) : m_Result(rhs), m_Refcount(0) {MakeRef(rhs);}
00330   result &amp;operator=(PGresult *);
00331   <span class="keywordtype">bool</span> operator!() <span class="keyword">const</span> <span class="keywordflow">throw</span> () { <span class="keywordflow">return</span> !m_Result; }
00332   operator bool() <span class="keyword">const</span> <span class="keywordflow">throw</span> () { <span class="keywordflow">return</span> m_Result != 0; }
00333   <span class="keywordtype">void</span> CheckStatus(<span class="keyword">const</span> PGSTD::string &amp;Query) <span class="keyword">const</span>;
00334 
<a name="l00335"></a><a class="code" href="classpqxx_1_1result.html#n2">00335</a>   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classpqxx_1_1Cursor.html">Cursor</a>;
00336   <span class="keyword">const</span> <span class="keywordtype">char</span> *CmdStatus() <span class="keyword">const</span> <span class="keywordflow">throw</span> () { <span class="keywordflow">return</span> PQcmdStatus(m_Result); }
00337 
00338 
00339   <span class="keywordtype">void</span> MakeRef(PGresult *);
00340   <span class="keywordtype">void</span> MakeRef(<span class="keyword">const</span> result &amp;);
00341   <span class="keywordtype">void</span> LoseRef() <span class="keywordflow">throw</span> ();
00342 };
00343 
00344 
00346 
<a name="l00353"></a><a class="code" href="classpqxx_1_1binarystring.html">00353</a> <span class="keyword">class </span>PQXX_LIBEXPORT binarystring : <span class="keyword">private</span> <a class="code" href="classpqxx_1_1PQAlloc.html">PQAlloc</a>&lt;unsigned char&gt;
00354 {
00355   <span class="keyword">typedef</span> <a class="code" href="classpqxx_1_1PQAlloc.html">PQAlloc&lt;unsigned char&gt;</a> super;
00356 <span class="keyword">public</span>:
<a name="l00357"></a><a class="code" href="classpqxx_1_1binarystring.html#w0">00357</a>   <span class="keyword">typedef</span> size_t size_type;
00358 
00360 
<a name="l00363"></a><a class="code" href="classpqxx_1_1binarystring.html#a0">00363</a>   <span class="keyword">explicit</span> binarystring(<span class="keyword">const</span> <a class="code" href="classpqxx_1_1result_1_1field.html">result::field</a> &amp;F) :                       <span class="comment">//[]</span>
00364     super(),
00365     m_size(0)
00366   {
00367     super::operator=(PQunescapeBytea(reinterpret_cast&lt;unsigned char *&gt;(
00368             const_cast&lt;char *&gt;(F.c_str())), &amp;m_size));
00369 
00370     <span class="comment">// TODO: More useful error message!  Distinguish bad_alloc from parse error</span>
00371     <span class="keywordflow">if</span> (!c_ptr()) 
00372       <span class="keywordflow">throw</span> PGSTD::runtime_error(<span class="stringliteral">"Unable to read bytea field"</span>);
00373   }
00374 
<a name="l00376"></a><a class="code" href="classpqxx_1_1binarystring.html#a1">00376</a>   size_type size() <span class="keyword">const</span> <span class="keywordflow">throw</span> () { <span class="keywordflow">return</span> m_size; }                    <span class="comment">//[]</span>
00377 
<a name="l00379"></a><a class="code" href="classpqxx_1_1binarystring.html#a2">00379</a>   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *bytes() <span class="keyword">const</span> <span class="keywordflow">throw</span> () { <span class="keywordflow">return</span> c_ptr(); }       <span class="comment">//[]</span>
00380 
00381 <span class="keyword">private</span>:
00382   size_type m_size;
00383 };
00384 
00385 
<a name="l00387"></a><a class="code" href="namespacepqxx.html#a12">00387</a> <span class="keyword">typedef</span> binarystring <a class="code" href="classpqxx_1_1binarystring.html">BinaryString</a>;
00388 
<a name="l00390"></a><a class="code" href="namespacepqxx.html#a13">00390</a> <span class="keyword">typedef</span> result <a class="code" href="classpqxx_1_1result.html">Result</a>;
00391 
00392 
00394 
00411 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> STREAM&gt;
<a name="l00412"></a><a class="code" href="namespacepqxx.html#a29">00412</a> <span class="keyword">inline</span> STREAM &amp;<a class="code" href="namespacepqxx.html#a29">operator&lt;&lt;</a>(STREAM &amp;S, <span class="keyword">const</span> <a class="code" href="classpqxx_1_1result_1_1field.html">pqxx::result::field</a> &amp;F)      <span class="comment">//[t46]</span>
00413 {
00414   S &lt;&lt; F.<a class="code" href="classpqxx_1_1result_1_1field.html#a1">c_str</a>();
00415   <span class="keywordflow">return</span> S;
00416 }
00417 
00418 
00419 
00420 <span class="keyword">inline</span> result::field 
<a name="l00421"></a><a class="code" href="classpqxx_1_1result_1_1tuple.html#a2">00421</a> result::tuple::operator[](result::tuple::size_type i)<span class="keyword"> const </span>
00422 <span class="keyword"></span>{ 
00423   <span class="keywordflow">return</span> <a class="code" href="classpqxx_1_1result_1_1field.html">field</a>(*<span class="keyword">this</span>, i); 
00424 }
00425 
<a name="l00426"></a><a class="code" href="classpqxx_1_1result_1_1tuple.html#a8">00426</a> <span class="keyword">inline</span> result::tuple::size_type result::tuple::size()<span class="keyword"> const </span>
00427 <span class="keyword"></span>{ 
00428   <span class="keywordflow">return</span> <a class="code" href="classpqxx_1_1result_1_1tuple.html#p0">m_Home</a>-&gt;<a class="code" href="classpqxx_1_1result.html#a12">Columns</a>(); 
00429 }
00430 
<a name="l00431"></a><a class="code" href="classpqxx_1_1result_1_1field.html#a2">00431</a> <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *result::field::Name()<span class="keyword"> const </span>
00432 <span class="keyword"></span>{ 
00433   <span class="keywordflow">return</span> <a class="code" href="classpqxx_1_1result_1_1tuple.html#p0">m_Home</a>-&gt;<a class="code" href="classpqxx_1_1result.html#a18">column_name</a>(m_Col); 
00434 }
00435 
00437 <span class="keyword">template</span>&lt;&gt; 
00438 <span class="keyword">inline</span> <span class="keywordtype">bool</span> result::field::to&lt;PGSTD::string&gt;(PGSTD::string &amp;Obj) <span class="keyword">const</span>
00439 {
00440   <span class="keywordflow">if</span> (is_null()) <span class="keywordflow">return</span> <span class="keyword">false</span>;
00441   Obj = c_str();
00442   <span class="keywordflow">return</span> <span class="keyword">true</span>;
00443 }
00444 
00446 
00449 <span class="keyword">template</span>&lt;&gt; 
00450 <span class="keyword">inline</span> <span class="keywordtype">bool</span> result::field::to&lt;const char *&gt;(<span class="keyword">const</span> <span class="keywordtype">char</span> *&amp;Obj) <span class="keyword">const</span>
00451 {
00452   <span class="keywordflow">if</span> (is_null()) <span class="keywordflow">return</span> <span class="keyword">false</span>;
00453   Obj = c_str();
00454   <span class="keywordflow">return</span> <span class="keyword">true</span>;
00455 }
00456 
00457 
00458 <span class="keyword">inline</span> result::const_iterator 
<a name="l00459"></a><a class="code" href="classpqxx_1_1result_1_1const__iterator.html#a15">00459</a> result::const_iterator::operator+(difference_type o)<span class="keyword"> const</span>
00460 <span class="keyword"></span>{
00461   <span class="keywordflow">return</span> <a class="code" href="classpqxx_1_1result_1_1const__iterator.html#a0">const_iterator</a>(<a class="code" href="classpqxx_1_1result_1_1tuple.html#p0">m_Home</a>, <a class="code" href="classpqxx_1_1result_1_1tuple.html#p1">m_Index</a> + o);
00462 }
00463 
00464 <span class="keyword">inline</span> result::const_iterator 
<a name="l00465"></a><a class="code" href="namespacepqxx.html#a30">00465</a> <a class="code" href="namespacepqxx.html#a30">operator+</a>(result::const_iterator::difference_type o, 
00466           <a class="code" href="classpqxx_1_1result_1_1const__iterator.html">result::const_iterator</a> i)
00467 {
00468   <span class="keywordflow">return</span> i + o;
00469 }
00470 
00471 <span class="keyword">inline</span> result::const_iterator 
<a name="l00472"></a><a class="code" href="classpqxx_1_1result_1_1const__iterator.html#a16">00472</a> result::const_iterator::operator-(difference_type o)<span class="keyword"> const</span>
00473 <span class="keyword"></span>{
00474   <span class="keywordflow">return</span> <a class="code" href="classpqxx_1_1result_1_1const__iterator.html#a0">const_iterator</a>(<a class="code" href="classpqxx_1_1result_1_1tuple.html#p0">m_Home</a>, <a class="code" href="classpqxx_1_1result_1_1tuple.html#p1">m_Index</a> - o);
00475 }
00476 
00477 <span class="keyword">inline</span> result::const_iterator::difference_type 
<a name="l00478"></a><a class="code" href="classpqxx_1_1result_1_1const__iterator.html#a17">00478</a> result::const_iterator::operator-(<a class="code" href="classpqxx_1_1result_1_1const__iterator.html">const_iterator</a> i)<span class="keyword"> const</span>
00479 <span class="keyword"></span>{ 
00480   <span class="keywordflow">return</span> <a class="code" href="classpqxx_1_1result_1_1const__iterator.html#a18">num</a>()-i.<a class="code" href="classpqxx_1_1result_1_1const__iterator.html#a18">num</a>(); 
00481 }
00482 
<a name="l00483"></a><a class="code" href="classpqxx_1_1result.html#a5">00483</a> <span class="keyword">inline</span> <a class="code" href="classpqxx_1_1result_1_1const__iterator.html">result::const_iterator</a> result::end()<span class="keyword"> const </span>
00484 <span class="keyword"></span>{ 
00485   <span class="keywordflow">return</span> <a class="code" href="classpqxx_1_1result_1_1const__iterator.html">const_iterator</a>(<span class="keyword">this</span>, <a class="code" href="classpqxx_1_1result.html#a6">size</a>()); 
00486 }
00487 
00488 } <span class="comment">// namespace pqxx</span>
00489 
00490 
00491 
00492 <span class="comment">/* </span>
00493 <span class="comment">[1] Scott Meyers, in one of his essential books, "Effective C++" and "More </span>
00494 <span class="comment">Effective C++", points out that it is good style to have any class containing </span>
00495 <span class="comment">a member of pointer type define its own destructor--just to show that it knows</span>
00496 <span class="comment">what it is doing.  This helps prevent nasty memory leak / double deletion bugs</span>
00497 <span class="comment">typically resulting from programmers' omission to deal with such issues in</span>
00498 <span class="comment">their destructors.</span>
00499 <span class="comment"></span>
00500 <span class="comment">The -Weffc++ option in gcc generates warnings for noncompliance with Scott's</span>
00501 <span class="comment">style guidelines, and hence necessitates the definition of this destructor,\</span>
00502 <span class="comment">trivial as it may be.</span>
00503 <span class="comment"></span>
00504 <span class="comment">[2] IIRC Alex Stepanov, the inventor of the STL, once remarked that having</span>
00505 <span class="comment">this as standard behaviour for pointers would be useful in some algorithms.</span>
00506 <span class="comment">So even if this makes me look foolish, I would seem to be in distinguished </span>
00507 <span class="comment">company.</span>
00508 <span class="comment">*/</span>
00509 
00510 <span class="preprocessor">#endif</span>
00511 <span class="preprocessor"></span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Jun 14 00:10:13 2003 for libpqxx by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.1 </small></address>
</body>
</html>
