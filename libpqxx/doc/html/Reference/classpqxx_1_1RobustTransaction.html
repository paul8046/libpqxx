<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>pqxx::RobustTransaction class Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>pqxx::RobustTransaction Class Reference</h1>Slower, better fortified version of <a class="el" href="classpqxx_1_1Transaction.html">Transaction</a>. 
<a href="#_details">More...</a>
<p>
<code>#include &lt;<a class="el" href="robusttransaction_8h-source.html">robusttransaction.h</a>&gt;</code>
<p>
<p>Inheritance diagram for pqxx::RobustTransaction:
<p><center><img src="classpqxx_1_1RobustTransaction.png" usemap="#pqxx::RobustTransaction_map" border="0" alt=""></center>
<map name="pqxx::RobustTransaction_map">
<area href="classpqxx_1_1TransactionItf.html" alt="pqxx::TransactionItf" shape="rect" coords="0,0,147,24">
</map>
<a href="classpqxx_1_1RobustTransaction-members.html">List of all members.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Public Member Functions</h2></td></tr>
<tr><td nowrap align=right valign=top>&nbsp;</td><td valign=bottom><a class="el" href="classpqxx_1_1RobustTransaction.html#a0">RobustTransaction</a> (<a class="el" href="classpqxx_1_1ConnectionItf.html">ConnectionItf</a> &amp;C, const PGSTD::string &amp;Name=PGSTD::string())</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Constructor.</em> <a href="#a0"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>virtual&nbsp;</td><td valign=bottom><a class="el" href="classpqxx_1_1RobustTransaction.html#a1">~RobustTransaction</a> ()</td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Slower, better fortified version of <a class="el" href="classpqxx_1_1Transaction.html">Transaction</a>.
<p>
<a class="el" href="classpqxx_1_1RobustTransaction.html">RobustTransaction</a> is similar to <a class="el" href="classpqxx_1_1Transaction.html">Transaction</a>, but spends more effort (and performance!) to deal with the hopefully rare case that the connection to the backend is lost just as the current transaction is being committed. In this case, there is no way to determine whether the backend managed to commit the transaction before noticing the loss of connection.<p>
In such cases, transaction class tries to reconnect to the database and figure out what happened. It will need to store and manage some information (pretty much a user-level transaction log) in the back-end for each and every transaction just on the off chance that this problem might occur. This service level was made optional since you may not want to pay this overhead where it is not necessary. Certainly the use of this class makes no sense for local connections, or for transactions that read the database but never modify it, or for noncritical database manipulations.<p>
Besides being slower, you may find that <a class="el" href="classpqxx_1_1RobustTransaction.html">RobustTransaction</a> actually fails more instead of less often than a normal <a class="el" href="classpqxx_1_1Transaction.html">Transaction</a>. This is due to the added work and complexity. What <a class="el" href="classpqxx_1_1RobustTransaction.html">RobustTransaction</a> tries to achieve is to be more deterministic, not more successful per se.<p>
When a user first uses a <a class="el" href="classpqxx_1_1RobustTransaction.html">RobustTransaction</a> in a database, the class will attempt to create a log table there to keep vital transaction-related state information in. This table, located in that same database, will be called PQXXLOG_*user*, where *user* is the PostgreSQL username for that user. If the log table can not be created, the transaction fails immediately.<p>
If the user does not have permission to create the log table, the database administrator may create one for him beforehand, and give ownership (or at least full insert/update rights) to the user. The table must contain two non-unique fields (which will never be null): "name" (of text type, varchar(256) by default) and "date" (of timestamp type). Older verions of <a class="el" href="classpqxx_1_1RobustTransaction.html">RobustTransaction</a> also added a unique "id" field; this field is now obsolete and the log table's implicit oids are used instead. The log tables' names may be made configurable in a future version of libpqxx.<p>
The transaction log table contains records describing unfinished transactions, i.e. ones that have been started but not, as far as the client knows, committed or aborted. This can mean any of the following:<p>
1. The transaction is in progress. Since backend transactions can't run for extended periods of time, this can only be the case if the log record's timestamp (compared to the server's clock) is not very old, provided of course that the server's system clock hasn't just made a radical jump.<p>
2. The client's connection to the server was lost, just when the client was committing the transaction, and the client so far has not been able to re-establish the connection to verify whether the transaction was actually completed or rolled back by the server. This is a serious (and luckily a rare) condition and requires manual inspection of the database to determine what happened. <a class="el" href="classpqxx_1_1RobustTransaction.html">RobustTransaction</a> will emit clear and specific warnings to this effect, and will identify the log record describing the transaction in question.<p>
3. The transaction was completed (either by commit or by rollback), but the client's connection was durably lost just as it tried to clean up the log record. Again, <a class="el" href="classpqxx_1_1RobustTransaction.html">RobustTransaction</a> will emit a clear and specific warning to tell you about this and request that the record be deleted as soon as possible.<p>
4. The client has gone offline at any time while in one of the preceding states. This also requires manual intervention, but the client obviously is not able to issue a warning.<p>
It is safe to drop a log table when it is not in use (ie., it is empty or all records in it represent states 2-4 above). <a class="el" href="classpqxx_1_1RobustTransaction.html">RobustTransaction</a> will attempt to recreate the table at its next time of use. 
<p>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a name="a0" doxytag="pqxx::RobustTransaction::RobustTransaction"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> pqxx::RobustTransaction::RobustTransaction </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="classpqxx_1_1ConnectionItf.html">ConnectionItf</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>C</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>const PGSTD::string &amp;&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>Name</em> = PGSTD::string()</td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [explicit]</code></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Constructor.
<p>
Creates <a class="el" href="classpqxx_1_1RobustTransaction.html">RobustTransaction</a>. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>C</em>&nbsp;</td><td>connection that this <a class="el" href="classpqxx_1_1RobustTransaction.html">RobustTransaction</a> should live inside. </td></tr>
    <tr><td valign=top><em>Name</em>&nbsp;</td><td>optional human-readable name for this <a class="el" href="classpqxx_1_1RobustTransaction.html">RobustTransaction</a>. </td></tr>
  </table>
</dl>
    </td>
  </tr>
</table>
<a name="a1" doxytag="pqxx::RobustTransaction::~RobustTransaction"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> pqxx::RobustTransaction::~RobustTransaction </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp;          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap><code> [virtual]</code></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="robusttransaction_8h-source.html">robusttransaction.h</a><li><a class="el" href="robusttransaction_8cxx.html">robusttransaction.cxx</a></ul>
<hr><address style="align: right;"><small>Generated on Fri Mar 21 00:21:21 2003 for libpqxx by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>
</body>
</html>
